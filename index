<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 2569 - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏£‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
     /* 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    body { 
      font-family: 'Sarabun', sans-serif; 
      background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%); 
      min-height: 100vh;
      color: #333;
    }
    
    /* 2. ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å */
    .main-container { 
      max-width: 1000px; 
      margin: 40px auto; 
      background: rgba(255, 255, 255, 0.95);
      padding: 50px; 
      border-radius: 20px; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
      position: relative;
      overflow: hidden;
    }
    .main-container::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 6px;
      background: linear-gradient(90deg, #0d6efd, #0dcaf0);
    }
   
    /* 3. ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
    .school-logo { 
      max-width: 130px; 
      height: auto; 
      margin-bottom: 15px; 
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); 
      transition: transform 0.3s;
    }
    .school-logo:hover { transform: scale(1.05) rotate(-3deg); }
    
    .main-title { 
      color: #0d6efd; 
      font-weight: 800; 
      letter-spacing: -0.5px;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.05);
    }
    .sub-title { color: #6c757d; font-weight: 500; }

    /* 4. ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
    .btn { border-radius: 50px; padding: 10px 25px; font-weight: 600; letter-spacing: 0.5px; transition: all 0.3s; }
    .btn-primary { 
      background: linear-gradient(45deg, #0d6efd, #0a58ca); 
      border: none; 
      box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
    }
    .btn-primary:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 8px 20px rgba(13, 110, 253, 0.4); 
    }
    .btn-success {
      background: linear-gradient(45deg, #198754, #157347);
      border: none;
      box-shadow: 0 4px 15px rgba(25, 135, 84, 0.3);
    }
    
    .btn-lg-custom { 
      padding: 25px; 
      font-size: 1.3rem; 
      border-radius: 15px; 
      border: none;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    .btn-lg-custom:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }

    /* 5. ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï */
    .form-label { font-weight: 600; color: #495057; font-size: 0.95rem; }
    .form-control, .form-select { 
      border-radius: 10px; 
      padding: 12px 15px; 
      border: 1px solid #dee2e6; 
      background-color: #f8f9fa;
      transition: all 0.3s;
    }
    .form-control:focus, .form-select:focus { 
      background-color: #fff; 
      border-color: #0d6efd; 
      box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.1); 
    }

  /* --- [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ --- */
    .digit-container { 
      display: flex; 
      gap: 8px; 
      justify-content: center; /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á */
      flex-wrap: wrap;         /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏õ‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏≠ */
      padding: 10px 0; 
    }

    /* ‡∏à‡∏±‡∏î‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
    #form-section .digit-container { 
      justify-content: flex-start; 
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á input */
    .digit-box { 
      width: 42px;    /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏à‡∏≤‡∏Å 45px ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
      height: 50px; 
      text-align: center; 
      font-size: 1.3rem; 
      font-weight: bold; 
      color: #0d6efd;
      border: 2px solid #e9ecef; 
      border-radius: 10px; 
      background: #fff;
      transition: all 0.2s; 
      flex-shrink: 0;
      margin-bottom: 8px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
    }
    
    .digit-box:focus { 
      border-color: #0d6efd; 
      transform: translateY(-3px); 
      box-shadow: 0 5px 15px rgba(13, 110, 253, 0.15); 
      outline: none; 
    }

    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô) */
    @media (max-width: 768px) {
      .digit-container { gap: 5px; }
      .digit-box { 
        width: 35px; 
        height: 45px; 
        font-size: 1.1rem; 
        margin-bottom: 5px;
      }
    }

    /* 6. Section Titles */
    .section-title { 
      border-left: none;
      background: linear-gradient(90deg, #e7f1ff, #fff);
      color: #0d6efd;
      padding: 15px 20px; 
      margin: 30px 0 20px; 
      font-weight: 700; 
      font-size: 1.1rem;
      border-radius: 10px; 
      display: flex; align-items: center;
    }
    .section-title i { margin-right: 10px; font-size: 1.3rem; }

    /* ‡∏≠‡∏∑‡πà‡∏ô‡πÜ */
    .hidden { display: none !important; }
    .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.8); backdrop-filter: blur(5px); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .req-star { color: #dc3545; margin-left: 3px; }
    
    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Report Section */
    .stat-item { border-left: 4px solid #0d6efd; transition: 0.2s; }
    .stat-item:hover { transform: translateX(5px); }
    .status-pill { font-size: 0.8rem; padding: 4px 10px; border-radius: 20px; white-space: nowrap; }
    .table-head-fix th { background: #f8f9fa; white-space: nowrap; }
    .tab-content-area { display: none; }
    .tab-active { display: block !important; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* --- [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] Responsive Styles ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin ‡πÅ‡∏•‡∏∞ Mobile --- */
    
    @media (max-width: 992px) {
      /* iPad ‡πÅ‡∏•‡∏∞‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á */
      .main-container { 
        padding: 30px; 
        max-width: 95%;
      }
    }

    @media (max-width: 768px) {
      /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      .main-container { 
        padding: 20px 15px; /* ‡∏•‡∏î Padding */
        margin: 15px auto;
        width: 98%;
        border-radius: 15px;
      }
      .digit-box { width: 38px; height: 48px; font-size: 1.2rem; }
      .btn-lg-custom { font-size: 1.1rem; padding: 20px; }
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß Admin */
      #admin-dashboard h3 { font-size: 1.5rem; }
      #admin-dashboard .btn { width: 100%; margin-bottom: 5px; } /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
      #admin-dashboard .d-flex.justify-content-between {
         flex-direction: column; 
         align-items: stretch !important;
         gap: 10px;
      }
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
      .table th, .table td { 
         font-size: 0.9rem; 
         padding: 0.5rem;
         white-space: nowrap; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö */
      }
    }

      /* 1. ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á: ‡πÑ‡∏•‡πà‡∏™‡∏µ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏≠‡πà‡∏≠‡∏ô‡πÜ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏à‡∏≤‡∏á‡πÜ ‡πÑ‡∏õ ‡∏ä‡∏°‡∏û‡∏π‡∏à‡∏≤‡∏á‡πÜ) ‡∏î‡∏π‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤ */
    body { 
      background: linear-gradient(135deg, #eafaf1 0%, #fdeef5 100%) !important; 
    }

    /* 2. ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á (‡πÑ‡∏•‡πà‡∏™‡∏µ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß -> ‡∏ä‡∏°‡∏û‡∏π) */
    .main-container::before {
      background: linear-gradient(90deg, #198754, #d63384) !important;
    }

    /* 3. ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏Ç‡πâ‡∏°) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) */
    .main-title { 
      color: #d63384 !important; /* ‡∏ä‡∏°‡∏û‡∏π */
      text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.8);
    }
    .sub-title { color: #5a7063 !important; }

    /* 4. ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°) */
    .section-title { 
      background: linear-gradient(90deg, #fce4ec, #fff) !important;
      color: #0f5132 !important; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏Å‡πà */
      border-left: 5px solid #d63384 !important; /* ‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢‡∏ä‡∏°‡∏û‡∏π */
    }
    .section-title i { color: #d63384 !important; } /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */

    /* 5. ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î (Button Theme) */
    
    /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡∏ü‡πâ‡∏≤ (btn-primary) ‡πÄ‡∏õ‡πá‡∏ô "‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏™‡∏î" (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©/‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) */
    .btn-primary { 
      background: linear-gradient(45deg, #d63384, #b02a6b) !important; 
      border: none !important;
      box-shadow: 0 4px 15px rgba(214, 51, 132, 0.3) !important;
    }
    .btn-primary:hover { 
      background: linear-gradient(45deg, #c2185b, #a01d5a) !important;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(214, 51, 132, 0.4) !important;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (btn-success) ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ/‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô) */
    .btn-success {
      background: linear-gradient(45deg, #198754, #146c43) !important;
      box-shadow: 0 4px 15px rgba(25, 135, 84, 0.3) !important;
    }

    /* 6. ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Focus ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π) */
    .form-control:focus, .form-select:focus { 
      border-color: #d63384 !important; 
      box-shadow: 0 0 0 4px rgba(214, 51, 132, 0.15) !important; 
    }

    /* 7. ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π ‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô) */
    .digit-box { 
      color: #d63384 !important; 
      border: 2px solid #d1e7dd !important;
    }
    .digit-box:focus {
      border-color: #d63384 !important;
      box-shadow: 0 5px 15px rgba(214, 51, 132, 0.15) !important;
    }

    /* 8. ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ */
    .text-primary { color: #d63384 !important; } /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏°‡∏û‡∏π */
    .spinner-border.text-primary { color: #d63384 !important; } /* ‡∏ï‡∏±‡∏ß‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏°‡∏∏‡∏ô‡πÜ ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
    
    /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å */
    .btn-lg-custom i { color: #fff !important; } /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */

</style>
</head>
<body>
  <div id="initial-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s ease-out;">
    <div class="text-center">
      <div class="spinner-border text-primary mb-3" style="width: 3.5rem; height: 3.5rem;" role="status"></div>
      <h5 class="fw-bold text-secondary animate__animated animate__pulse animate__infinite">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...</h5>
      <small class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</small>
    </div>
  </div>

  <div id="loading" class="loading-overlay hidden">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
    
    <div class="mt-3 fw-bold text-primary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    
    <div class="progress mt-3" style="width: 60%; height: 25px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <div id="progressBar" 
             class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
             role="progressbar" 
             style="width: 0%; font-size: 14px;">
             0%
        </div>
    </div>
    <small class="text-muted mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</small>
</div>

  <div class="container main-container">
    <div class="text-center mb-5" id="main-header">
      <img src="https://drive.google.com/thumbnail?id=1orEjf83Ew6ygXmhqSyEmGawrvy0UUhGq&sz=w1000" alt="‡∏ï‡∏£‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="school-logo">
      <h3 class="main-title">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏£‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</h3>
      <p class="sub-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2569</p>
    </div>

    <div id="home-section">
      <div class="row g-3">
        <div class="col-12"><div class="alert alert-primary text-center shadow-sm">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div></div>
        <div class="col-md-6"><button class="btn btn-primary w-100 btn-lg-custom shadow-sm" onclick="openForm('special')"><i class="bi bi-star-fill me-2"></i>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</button></div>
        <div class="col-md-6"><button class="btn btn-success w-100 btn-lg-custom shadow-sm" onclick="openForm('general')"><i class="bi bi-book-half me-2"></i>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button></div>
        <div class="col-12 mt-4"><button class="btn btn-outline-secondary w-100 py-3 rounded-pill" onclick="showSection('status-section')"><i class="bi bi-search me-2"></i>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div>
        <div class="col-12 mt-2">
          <button class="btn btn-info w-100 py-3 rounded-pill text-white shadow-sm" onclick="showReport()">
            <i class="bi bi-list-ol me-2"></i>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
          </button>
        </div>
        <div class="col-12 text-center mt-3"><a href="#" onclick="showSection('admin-login-section')" class="text-muted text-decoration-none small"><i class="bi bi-shield-lock"></i> ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</a></div>
      </div>
    </div>

    <div id="form-section" class="hidden">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-primary fw-bold"><i class="bi bi-pencil-square me-2"></i>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h4>
        <button class="btn btn-sm btn-outline-secondary" onclick="softReset()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
      <div class="alert alert-warning hidden shadow-sm" id="edit-alert"><i class="bi bi-pencil-fill me-2"></i>‡∏ó‡πà‡∏≤‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      <div class="alert alert-light border shadow-sm text-danger mb-3"><i class="bi bi-exclamation-circle-fill me-2"></i>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ *</div>
     
      <form id="appForm" onsubmit="handleSubmit(event)">
        <input type="hidden" id="applyType"><input type="hidden" id="isEditMode" value="false"><input type="hidden" id="editIdCard">
       
        <h5 class="section-title">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
<div class="row g-3">
   <div class="col-md-4">
     <label class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ <span class="req-star">*</span></label>
     <select id="level" class="form-select" required onchange="loadPlans()">
       <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
       <option value="‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1">‡∏°.1</option>
       <option value="‡∏ä‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4">‡∏°.4</option>
     </select>
   </div>
   <div class="col-md-8">
     <label class="form-label">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="req-star">*</span></label>
     <select id="plan" class="form-select" required>
       <option value="">- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô -</option>
     </select>
   </div>
   
   <div class="col-md-2">
     <label class="form-label">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ <span class="req-star">*</span></label>
     <select id="prefix" class="form-select">
       <option>‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢</option>
       <option>‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á</option>
       <option>‡∏ô‡∏≤‡∏¢</option>
       <option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
     </select>
   </div>
   <div class="col-md-5">
     <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢) <span class="req-star">*</span></label>
     <input type="text" id="firstname" class="form-control text-only" required placeholder="‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤">
   </div>
   <div class="col-md-5">
     <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢) <span class="req-star">*</span></label>
     <input type="text" id="lastname" class="form-control text-only" required>
   </div>

   <div class="col-md-6">
     <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©) <span class="req-star">*</span></label>
     <input type="text" id="firstnameEn" class="form-control text-eng" placeholder="English First Name" required>
   </div>
   <div class="col-md-6">
     <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©) <span class="req-star">*</span></label>
     <input type="text" id="lastnameEn" class="form-control text-eng" placeholder="English Last Name" required>
   </div>

    <div class="col-md-4">
     <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î <span class="req-star">*</span></label>
     <input type="date" id="dob" class="form-control" required>
   </div>
   <div class="col-md-4">
      <label class="form-label">‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥ <span class="req-star">*</span></label>
      <select id="nationality" class="form-select" onchange="toggleOther('nationality', 'nationality_other')">
          <option value="‡πÑ‡∏ó‡∏¢">‡πÑ‡∏ó‡∏¢</option>
          <option value="‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤">‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤</option>
          <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
      </select>
      <input type="text" id="nationality_other" class="form-control mt-2 hidden" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏±‡∏ç‡∏ä‡∏≤‡∏ï‡∏¥">
   </div>
   <div class="col-md-4">
      <label class="form-label">‡∏®‡∏≤‡∏™‡∏ô‡∏≤ <span class="req-star">*</span></label>
      <select id="religion" class="form-select" onchange="toggleOther('religion', 'religion_other')">
          <option value="‡∏û‡∏∏‡∏ó‡∏ò">‡∏û‡∏∏‡∏ó‡∏ò</option>
          <option value="‡∏≠‡∏¥‡∏™‡∏•‡∏≤‡∏°">‡∏≠‡∏¥‡∏™‡∏•‡∏≤‡∏°</option>
          <option value="‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå">‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå</option>
          <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
      </select>
      <input type="text" id="religion_other" class="form-control mt-2 hidden" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏®‡∏≤‡∏™‡∏ô‡∏≤">
   </div>

   <div class="col-12">
     <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (13 ‡∏´‡∏•‡∏±‡∏Å) <span class="req-star">*</span></label>
     <div class="digit-container" id="idCard-container"></div>
     <input type="hidden" id="idCard">
   </div>

   <div class="col-12">
     <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å) <span class="req-star">*</span></label>
     <div class="digit-container" id="phone-container"></div>
     <input type="hidden" id="phone">
   </div>

   <div class="col-md-8">
     <label class="form-label">‡∏à‡∏ö‡∏à‡∏≤‡∏Å‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏°) <span class="req-star">*</span></label>
     <input type="text" id="oldSchoolName" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)" required>  
   </div>
   <div class="col-md-4">
     <label class="form-label">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏° <span class="req-star">*</span></label>
     <select id="oldSchoolProvince" class="form-select" required>
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
     </select>
   </div>
</div>

        <h5 class="section-title">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h5>
        <div class="row g-3">
           <div class="col-md-3"><label class="form-label">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <span class="req-star">*</span></label><input type="text" id="addrNo" class="form-control" required></div>
           <div class="col-md-2"><label class="form-label">‡∏´‡∏°‡∏π‡πà <span class="req-star">*</span></label><input type="text" id="addrMoo" class="form-control" required></div>
           <div class="col-md-3"><label class="form-label">‡∏ã‡∏≠‡∏¢ <span class="req-star">*</span></label><input type="text" id="addrSoi" class="form-control" required></div>
           <div class="col-md-4"><label class="form-label">‡∏ñ‡∏ô‡∏ô <span class="req-star">*</span></label><input type="text" id="addrRoad" class="form-control" required></div>
           <div class="col-md-4"><label class="form-label">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span class="req-star">*</span></label><select id="province" class="form-select" required onchange="chProv()"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option></select></div>
           <div class="col-md-4"><label class="form-label">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <span class="req-star">*</span></label><select id="district" class="form-select" required onchange="chDist()" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option></select></div>
           <div class="col-md-4"><label class="form-label">‡∏ï‡∏≥‡∏ö‡∏• <span class="req-star">*</span></label><select id="subdistrict" class="form-select" required onchange="chSub()" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option></select></div>
           <div class="col-md-4"><label class="form-label">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå <span class="req-star">*</span></label><input type="text" id="zipcode" class="form-control bg-light" readonly></div>
        </div>

        <h5 class="section-title">3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</h5>
        <div class="mb-3"><label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏î‡∏≤-‡∏°‡∏≤‡∏£‡∏î‡∏≤</label><select id="famStatus" class="form-select"><option>‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</option><option>‡∏´‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏á</option><option>‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà</option><option>‡∏ö‡∏¥‡∏î‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏Å‡πà‡∏Å‡∏£‡∏£‡∏°</option><option>‡∏°‡∏≤‡∏£‡∏î‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏Å‡πà‡∏Å‡∏£‡∏£‡∏°</option></select></div>
       
       <div class="parent-card">
           <div class="parent-header">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏¥‡∏î‡∏≤</div>
           <div class="row g-2">
             <div class="col-3">
              <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                 <select id="f_prefix" class="form-select" onchange="toggleOther('f_prefix', 'f_prefix_other')">
                    <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                   </select>
                 <input type="text" id="f_prefix_other" class="form-control mt-2 hidden" placeholder="‡∏£‡∏∞‡∏ö‡∏∏">
                </div>
             <div class="col-4"><label>‡∏ä‡∏∑‡πà‡∏≠ </label><input type="text" id="f_name" class="form-control text-only" ></div>
             <div class="col-5"><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• </label><input type="text" id="f_lname" class="form-control text-only" ></div>
             <div class="col-5"><label>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û </label><input type="text" id="f_job" class="form-control" ></div>
             <div class="col-2"><label>‡∏≠‡∏≤‡∏¢‡∏∏</label><input type="number" id="f_age" class="form-control" placeholder="‡∏õ‡∏µ"></div>
             <div class="col-5"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ </label><input type="text" id="f_phone" class="form-control num-only" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô" maxlength="10" ></div>
             <div class="col-12"><div class="form-check"><input class="form-check-input" type="checkbox" id="f_same" onchange="toggleAddr('f')"><label class="form-check-label" for="f_same">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label></div></div>
             <div class="col-12" id="f_addr_div" >
                <div class="card bg-light border-0 p-3 mt-2">
                    <label class="fw-bold mb-2 text-primary">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏¥‡∏î‡∏≤</label>
                    <div class="row g-2">
                        <div class="col-md-3 col-6"><input type="text" id="f_addr_no" class="form-control" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà"></div>
                        <div class="col-md-3 col-6"><input type="text" id="f_addr_moo" class="form-control" placeholder="‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà"></div>
                        <div class="col-md-6"><input type="text" id="f_addr_road" class="form-control" placeholder="‡∏ñ‡∏ô‡∏ô/‡∏ã‡∏≠‡∏¢"></div>
                        <div class="col-md-4"><select id="f_addr_prov" class="form-select" onchange="chProvP('f')"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option></select></div>
                        <div class="col-md-4"><select id="f_addr_dist" class="form-select" onchange="chDistP('f')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï</option></select></div>
                        <div class="col-md-4"><select id="f_addr_sub" class="form-select" onchange="chSubP('f')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á</option></select></div>
                        <div class="col-md-12"><input type="text" id="f_addr_zip" class="form-control bg-white" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" readonly></div>
                    </div>
                </div>
             </div>
           </div>
        </div>

        <div class="parent-card">
           <div class="parent-header">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏£‡∏î‡∏≤</div>
           <div class="row g-2">
             <div class="col-3"><label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label><select id="m_prefix" class="form-select"><option>‡∏ô‡∏≤‡∏á</option><option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option></select></div>
             <div class="col-4"><label>‡∏ä‡∏∑‡πà‡∏≠ </label><input type="text" id="m_name" class="form-control text-only" ></div>
             <div class="col-5"><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• </label><input type="text" id="m_lname" class="form-control text-only" ></div>
             <div class="col-5"><label>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û </label><input type="text" id="m_job" class="form-control" ></div>
             <div class="col-2"><label>‡∏≠‡∏≤‡∏¢‡∏∏</label><input type="number" id="m_age" class="form-control" placeholder="‡∏õ‡∏µ"></div>
             <div class="col-5"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ </label><input type="text" id="m_phone" class="form-control num-only" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô" maxlength="10" ></div>
             <div class="col-12"><div class="form-check"><input class="form-check-input" type="checkbox" id="m_same" onchange="toggleAddr('m')"><label class="form-check-label" for="m_same">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label></div></div>
             <div class="col-12" id="m_addr_div" >
                <div class="card bg-light border-0 p-3 mt-2">
                    <label class="fw-bold mb-2 text-primary">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏≤‡∏£‡∏î‡∏≤</label>
                    <div class="row g-2">
                        <div class="col-md-3 col-6"><input type="text" id="m_addr_no" class="form-control" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà"></div>
                        <div class="col-md-3 col-6"><input type="text" id="m_addr_moo" class="form-control" placeholder="‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà"></div>
                        <div class="col-md-6"><input type="text" id="m_addr_road" class="form-control" placeholder="‡∏ñ‡∏ô‡∏ô/‡∏ã‡∏≠‡∏¢"></div>
                        <div class="col-md-4"><select id="m_addr_prov" class="form-select" onchange="chProvP('m')"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option></select></div>
                        <div class="col-md-4"><select id="m_addr_dist" class="form-select" onchange="chDistP('m')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï</option></select></div>
                        <div class="col-md-4"><select id="m_addr_sub" class="form-select" onchange="chSubP('m')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á</option></select></div>
                        <div class="col-md-12"><input type="text" id="m_addr_zip" class="form-control bg-white" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" readonly></div>
                    </div>
                </div>
             </div>
           </div>
        </div>

        <div class="parent-card">
           <div class="parent-header">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</div>
           <div class="mb-2 bg-light p-2 rounded"><small class="text-muted"><i class="bi bi-info-circle me-1"></i>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: <input type="checkbox" id="use_f" onchange="copyP('f')"> ‡∏ö‡∏¥‡∏î‡∏≤ | <input type="checkbox" id="use_m" onchange="copyP('m')"> ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏£‡∏î‡∏≤</small></div>
           <div class="row g-2">
             <div class="col-3"><label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label><select id="g_prefix" class="form-select"><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏ô‡∏≤‡∏á</option><option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option></select></div>
             <div class="col-4"><label>‡∏ä‡∏∑‡πà‡∏≠ </label><input type="text" id="g_name" class="form-control text-only" ></div>
             <div class="col-5"><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• </label><input type="text" id="g_lname" class="form-control text-only" ></div>
            <div class="col-3">
                     <label>‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</label>
                          <select id="g_rel" class="form-select"  onchange="toggleOther('g_rel', 'g_rel_other')">
                              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                              <option value="‡∏ö‡∏¥‡∏î‡∏≤">‡∏ö‡∏¥‡∏î‡∏≤</option>
                              <option value="‡∏°‡∏≤‡∏£‡∏î‡∏≤">‡∏°‡∏≤‡∏£‡∏î‡∏≤</option>
                              <option value="‡∏õ‡∏π‡πà/‡∏¢‡πà‡∏≤/‡∏ï‡∏≤/‡∏¢‡∏≤‡∏¢">‡∏õ‡∏π‡πà/‡∏¢‡πà‡∏≤/‡∏ï‡∏≤/‡∏¢‡∏≤‡∏¢</option>
                              <option value="‡∏û‡∏µ‡πà/‡∏õ‡πâ‡∏≤/‡∏ô‡πâ‡∏≤/‡∏≠‡∏≤">‡∏û‡∏µ‡πà/‡∏õ‡πâ‡∏≤/‡∏ô‡πâ‡∏≤/‡∏≠‡∏≤</option>
                              <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
                          </select>
                       <input type="text" id="g_rel_other" class="form-control mt-2 hidden" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á">
                  </div>
             <div class="col-3"><label>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label><input type="text" id="g_job" class="form-control" ></div>
             <div class="col-2"><label>‡∏≠‡∏≤‡∏¢‡∏∏</label><input type="number" id="g_age" class="form-control"></div>
             <div class="col-4"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="text" id="g_phone" class="form-control num-only" maxlength="10" ></div>
             <div class="col-12"><div class="form-check"><input class="form-check-input" type="checkbox" id="g_same" onchange="toggleAddr('g')"><label class="form-check-label" for="g_same">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label></div></div>
             <div class="col-12" id="g_addr_div" >
                <div class="card bg-light border-0 p-3 mt-2">
                    <label class="fw-bold mb-2 text-primary">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                    <div class="row g-2">
                         <div class="col-md-3 col-6"><input type="text" id="g_addr_no" class="form-control" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà"></div>
                        <div class="col-md-3 col-6"><input type="text" id="g_addr_moo" class="form-control" placeholder="‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà"></div>
                        <div class="col-md-6"><input type="text" id="g_addr_road" class="form-control" placeholder="‡∏ñ‡∏ô‡∏ô/‡∏ã‡∏≠‡∏¢"></div>
                        <div class="col-md-4"><select id="g_addr_prov" class="form-select" onchange="chProvP('g')"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option></select></div>
                        <div class="col-md-4"><select id="g_addr_dist" class="form-select" onchange="chDistP('g')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï</option></select></div>
                        <div class="col-md-4"><select id="g_addr_sub" class="form-select" onchange="chSubP('g')" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á</option></select></div>
                        <div class="col-md-12"><input type="text" id="g_addr_zip" class="form-control bg-white" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" readonly></div>
                    </div>
                </div>
             </div>
           </div>
        </div>

        <h5 class="section-title">4. ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h5>
        <div class="mb-3">
            <label class="form-label">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á) <span class="req-star">*</span></label>
            <input type="file" id="photoFile" class="form-control" accept="image/*" onchange="readF(this,'photo64')">
            <input type="hidden" id="photo64">
            <div id="oldPhoto" class="hidden mt-2"></div>
            <div id="newPhotoPreview" class="mt-2 text-center" style="display:none;">
             <small class="text-success d-block mb-1">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</small>
              <img id="imgPreview" src="" class="img-thumbnail" style="max-height: 180px;">
            </div>
        </div>
        <div id="ts-box" class="mb-4">
            <label class="form-label">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏õ‡∏û.1) 5 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô  <span class="req-star">*</span></label>
            <input type="file" id="tsFile" class="form-control" accept="image/*,application/pdf" onchange="readF(this,'ts64')">
            <input type="hidden" id="ts64">
            <div id="oldTs" class="hidden mt-2"></div>
        </div>
        <div id="conduct-box" class="mb-4">
            <label class="form-label">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥ <span class="req-star">*</span></label>
            <input type="file" id="conductFile" class="form-control" accept="image/*,application/pdf" onchange="readF(this,'conduct64')">
            <input type="hidden" id="conduct64">
         <div id="oldConduct" class="hidden mt-2"></div>
        </div>
        <hr class="my-4">
        <button type="submit" id="submitBtn" class="btn btn-primary w-100 py-3 fs-5 rounded-pill shadow">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
      </form>
    </div>

    <div id="status-section" class="hidden text-center">
      <h4 class="mt-3 fw-bold">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h4>
      <p class="text-muted">‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å</p>
      <div class="digit-container mt-4 mb-4" id="checkIdCard-container"></div>
      <input type="hidden" id="checkIdCard">
      <button class="btn btn-primary px-5 rounded-pill" onclick="doCheck()"><i class="bi bi-search me-2"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      <div id="status-result" class="mt-4"></div>
      
      <button class="btn btn-link text-muted mt-3" onclick="softReset()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

    <div id="report-section" class="hidden">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 pt-2">
        <div class="mb-2 mb-md-0">
          <h4 class="fw-bold text-dark mb-1"><i class="bi bi-person-lines-fill text-primary me-2"></i>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h4>
          <small class="text-muted">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</small>
        </div>
        <button class="btn btn-secondary rounded-pill px-4" type="button" onclick="softReset()">
          <i class="bi bi-arrow-left me-1"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </button>
      </div>
      
      <div id="stat-loading" class="text-center py-5">
         <div class="spinner-border text-primary" role="status"></div>
         <div class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
      </div>

      <div id="reportContent" class="hidden">
        <div class="d-flex justify-content-center mb-4 bg-light p-1 rounded-pill border">
            <button id="btn-m1" class="btn btn-primary rounded-pill w-50 fw-bold" onclick="switchTab('m1')"> ‡∏°.1 <span id="badge-m1" class="badge bg-white text-primary ms-1 rounded-pill">0</span> </button>
            <button id="btn-m4" class="btn btn-light text-muted rounded-pill w-50 fw-bold" onclick="switchTab('m4')"> ‡∏°.4 <span id="badge-m4" class="badge bg-secondary text-white ms-1 rounded-pill">0</span> </button>
        </div>
        <div id="pane-m1" class="tab-content-area tab-active">
          <div class="row g-3">
             <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                   <div class="card-header bg-white fw-bold text-primary">‡∏¢‡∏≠‡∏î‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Ø</div>
                   <div class="card-body p-2" id="stat-list-m1"></div>
                </div>
             </div>
             <div class="col-md-8">
                <div class="card shadow-sm border-0 h-100">
                   <div class="card-header bg-white">
                      <div class="row g-2">
                         <div class="col-7"><input type="text" class="form-control form-control-sm rounded-pill bg-light" id="searchM1" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠..." onkeyup="filterTable('m1')"></div>
                         <div class="col-5"><select class="form-select form-select-sm rounded-pill bg-light" id="filterPlanM1" onchange="filterTable('m1')"></select></div>
                      </div>
                   </div>
                   <div class="table-responsive" style="max-height: 500px;">
                      <table class="table table-hover align-middle mb-0">
                         <thead class="table-head-fix sticky-top shadow-sm"><tr><th class="ps-3">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead>
                         <tbody id="list-body-m1"></tbody>
                      </table>
                   </div>
                </div>
             </div>
          </div>
        </div>
        <div id="pane-m4" class="tab-content-area">
          <div class="row g-3">
             <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                   <div class="card-header bg-white fw-bold text-success">‡∏¢‡∏≠‡∏î‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Ø</div>
                   <div class="card-body p-2" id="stat-list-m4"></div>
                </div>
             </div>
             <div class="col-md-8">
                <div class="card shadow-sm border-0 h-100">
                   <div class="card-header bg-white">
                      <div class="row g-2">
                         <div class="col-7"><input type="text" class="form-control form-control-sm rounded-pill bg-light" id="searchM4" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠..." onkeyup="filterTable('m4')"></div>
                         <div class="col-5"><select class="form-select form-select-sm rounded-pill bg-light" id="filterPlanM4" onchange="filterTable('m4')"></select></div>
                      </div>
                   </div>
                   <div class="table-responsive" style="max-height: 500px;">
                      <table class="table table-hover align-middle mb-0">
                         <thead class="table-head-fix sticky-top shadow-sm"><tr><th class="ps-3">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead>
                         <tbody id="list-body-m4"></tbody>
                      </table>
                   </div>
                </div>
             </div>
          </div>
        </div>
      </div>
    </div>

    <div id="admin-login-section" class="hidden">
      <div class="col-md-6 col-lg-5 mx-auto card p-5 shadow border-0 mt-4 text-center">
        <h4 class="fw-bold mb-4">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h4>
        <input type="text" id="aUser" class="form-control mb-3 p-3" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Username)">
        <input type="password" id="aPass" class="form-control mb-3 p-3" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)">
        <button class="btn btn-dark w-100 py-3 rounded-pill" onclick="doLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button class="btn btn-link mt-3 text-muted" onclick="softReset()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
      </div>
    </div>

    <div id="admin-dashboard" class="hidden">
      <div class="d-flex justify-content-between align-items-center mb-4">
         <h3 class="fw-bold"><i class="bi bi-speedometer2 text-primary"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
         <div class="d-flex gap-2 btn-action-group">
            <button onclick="exportToExcel()" class="btn btn-success shadow-sm"><i class="bi bi-file-earmark-excel"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel</button>
            <button class="btn btn-outline-danger btn-sm" onclick="logout()"><i class="bi bi-box-arrow-right"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
         </div>
      </div>
      
      <div class="d-flex flex-column gap-2 my-3 p-3 bg-light rounded border">
          <div class="form-check form-switch">
             <input class="form-check-input" type="checkbox" id="toggleSpecial" onchange="toggleSystem('special', this)" style="cursor: pointer;">
             <label class="form-check-label fw-bold text-primary" for="toggleSpecial">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</label>
          </div>
          <div class="form-check form-switch">
             <input class="form-check-input" type="checkbox" id="toggleGeneral" onchange="toggleSystem('general', this)" style="cursor: pointer;">
             <label class="form-check-label fw-bold text-success" for="toggleGeneral">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</label>
          </div>
      </div>

      <div class="row mb-4 g-3">
         <div class="col-md-6">
            <div class="card shadow-sm h-100">
               <div class="card-body">
                  <h6 class="text-muted mb-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h6>
                  <div class="chart-container" style="position: relative; height: 350px; overflow-y: auto; overflow-x: hidden; padding-right: 10px;">
                      <canvas id="chartPlan"></canvas>
                  </div>
               </div>
            </div>
         </div>
         <div class="col-md-6">
            <div class="card shadow-sm h-100">
               <div class="card-body">
                  <h6 class="text-muted mb-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h6>
                  <canvas id="chartStatus" style="max-height:250px;"></canvas>
               </div>
            </div>
         </div>
      </div>

      <div class="card shadow-sm border-0">
         <div class="card-header bg-white py-3 border-bottom-0">
             <div class="input-group">
                 <span class="input-group-text bg-light border-0"><i class="bi bi-search"></i></span>
                 <input type="text" id="aSearch" class="form-control bg-light border-0" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£, ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞..." onkeyup="filterTbl()">
             </div>
         </div>
         <div class="card border-0 shadow-sm mb-3">
             <div class="card-body p-2">
                 <div class="row g-2 align-items-center">
                     <div class="col-12 col-lg-4">
                        <div class="input-group">
                           <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
                           <input type="text" id="searchBox" class="form-control border-start-0 ps-0" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£..." onkeyup="filterTbl()">
                        </div>
                     </div>
                     <div class="col-6 col-lg-2">
                        <select id="levelFilter" class="form-select" onchange="filterTbl()">
                           <option value="all">üìö ‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                           <option value="‡∏°.1">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1</option>
                           <option value="‡∏°.4">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4</option>
                        </select>
                     </div>

                      <div class="col-6 col-lg-3">
                      <select id="planFilter" class="form-select" onchange="filterTbl()">
                      <option value="all">üìñ ‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                      </select>
                      </div>


                     <div class="col-6 col-lg-3">
                        <select id="statusFilter" class="form-select" onchange="filterTbl()">
                           <option value="all">‚ö° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                           <option value="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‚è≥ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                           <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                           <option value="‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</option>
                        </select>
                     </div>
                     <div class="col-6 col-lg-2">
                         <select id="rowsFilter" class="form-select" onchange="filterTbl()">
                             <option value="20">‡πÇ‡∏ä‡∏ß‡πå 20 ‡∏Ñ‡∏ô</option>
                             <option value="50">‡πÇ‡∏ä‡∏ß‡πå 50 ‡∏Ñ‡∏ô</option>
                             <option value="100">‡πÇ‡∏ä‡∏ß‡πå 100 ‡∏Ñ‡∏ô</option>
                             <option value="all">‡πÇ‡∏ä‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                         </select>
                     </div>
                     <div class="col-6 col-lg-1">
                        <button class="btn btn-light w-100 text-muted border" onclick="resetFilter()"><i class="bi bi-arrow-counterclockwise"></i></button>
                     </div>
                 </div>
             </div>
         </div>

         <div class="table-responsive">
            <table class="table table-hover align-middle mb-0" id="aTable">
                <thead class="table-light sticky-top" style="z-index: 1;">
                   <tr>
                      <th style="min-width: 250px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th> <th style="min-width: 120px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                      <th style="min-width: 150px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                   </tr>
                </thead>
                <tbody>
                   </tbody>
            </table>
         </div>
      </div>
    </div>

  </div> <div class="modal fade" id="sModal">
     <div class="modal-dialog modal-lg">
        <div class="modal-content">
           <div class="modal-header bg-light">
               <h5 class="modal-title fw-bold"><i class="bi bi-person-lines-fill me-2"></i>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
           </div>
           <div class="modal-body p-4" id="mBody"></div>
           <div class="modal-footer bg-light">
               <button class="btn btn-outline-dark me-auto" onclick="window.print()"><i class="bi bi-printer"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
               <div class="d-flex gap-2">
                   <button class="btn btn-warning" onclick="upSt('‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')">‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                   <button class="btn btn-danger" onclick="upSt('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å')">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                   <button class="btn btn-success px-4" onclick="upSt('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
               </div>
           </div>
        </div>
     </div>
  </div>

  <div class="modal fade" id="statModal">
     <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
           <div class="modal-header bg-primary text-white">
               <h5 class="modal-title fw-bold"><i class="bi bi-bar-chart-fill me-2"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h5>
               <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
           </div>
           <div class="modal-body"><canvas id="statChartFull"></canvas></div>
        </div>
     </div>
  </div>
  <div class="modal fade" id="docPreviewModal" tabindex="-1" aria-hidden="true" style="z-index: 1060;">
  <div class="modal-dialog modal-xl modal-dialog-centered" style="height: 90vh;">
    <div class="modal-content h-100">
      <div class="modal-header bg-light py-2">
        <h5 class="modal-title fs-6"><i class="bi bi-eye-fill me-2"></i>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h5>
        <div class="ms-auto">
          <a href="#" id="btnOpenOriginal" target="_blank" class="btn btn-sm btn-outline-primary me-2">
            <i class="bi bi-box-arrow-up-right"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
          </a>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>
      <div class="modal-body p-0 bg-dark d-flex justify-content-center align-items-center">
        <iframe id="docFrame" src="" style="width:100%; height:100%; border:none;"></iframe>
      </div>
    </div>
  </div>
</div>


<style>
  .line-float-btn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    z-index: 9999; /* ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á */
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background-color: #06C755; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß LINE */
    color: white !important;
    text-decoration: none;
    border-radius: 50px; /* ‡∏ó‡∏£‡∏á‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•‡∏°‡∏ô‡πÜ */
    font-family: 'Sarabun', sans-serif; /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö */
    font-weight: 600;
  }

  .line-float-btn:hover {
    transform: translateY(-3px); /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ */
    box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    background-color: #05b54d;
  }

  .line-icon {
    font-size: 24px;
  }
</style>

<a href="https://line.me/ti/g2/Z5WNo7tXT5nQP1LnY-_1E9OKqRnLJc-JQ4635g?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" class="line-float-btn">
  <i class="bi bi-line line-icon"></i>
  <span>‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
</a>


  <footer class="text-center mt-4 mb-5" style="opacity: 0.8;">
  <p class="mb-0 text-secondary" style="font-size: 0.9rem;">
    &copy; 2026 ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
  </p>
  <p class="mb-0 text-muted" style="font-size: 0.85rem;">
    ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ <span class="fw-bold text-primary">‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏©‡∏ì‡∏∏ ‡πÅ‡∏à‡πà‡∏°‡∏õ‡∏£‡∏µ‡∏ä‡∏≤</span>
  </p>
</footer>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>


  document.addEventListener('DOMContentLoaded', function() {
    // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á Popup
    setTimeout(function() {
      Swal.fire({
        title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£',
        html: `
          <div style="text-align: left; font-family: 'Sarabun', sans-serif; font-size: 16px; color: #333;">
            <div style="margin-bottom: 10px;">
              <strong>1.</strong> ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ä‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á
            </div>
            <div style="margin-bottom: 10px;">
              <strong>2.</strong> ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏õ‡∏û.1) 5 ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </div>
            <div style="margin-bottom: 15px;">
              <strong>3.</strong> ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥
            </div>
            
            <div style="background-color: #fff0f6; border: 1px dashed #d63384; padding: 15px; border-radius: 10px; font-size: 14px; color: #d63384; line-height: 1.6;">
              <strong><u>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</u></strong><br>
              ‚Ä¢ ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB<br>
              ‚Ä¢ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: PDF, PNG, JPEG<br>
              ‚Ä¢ <span style="color: #c2185b; font-weight: bold;">‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</span> ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô PNG, JPEG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>
              ‚Ä¢ <strong>‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</strong>
            </div>
          </div>
        `,
        icon: 'info',
        width: '550px',
        confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
        confirmButtonColor: '#d63384',
        allowOutsideClick: false,
        allowEscapeKey: false,
        didOpen: () => {
             const container = Swal.getContainer();
             if(container) container.style.zIndex = '10000';
        }
      });
    }, 500); 
  });

  
    let addrDB=[], allSt=[], curIdx=null, aRole=0, aName="";
    let myModal = null; // Detail Modal
    let statModal = null; // Stat Modal
    let cPlan=null, cStatus=null; // Charts


    const el = (id) => document.getElementById(id);
    const show = (id) => el(id).classList.remove('hidden');
    const hide = (id) => el(id).classList.add('hidden');
   
    function loading(o) { o ? show('loading') : hide('loading'); }
    function alertErr(m) { loading(0); Swal.fire({icon:'error', title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text:m}); }
   
   // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡πÄ‡∏û‡∏¥‡πà‡∏° 'report-section' ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏ô)
// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 'report-section' ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏õ)
function showSection(id) {
    // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    const allSections = ['home-section', 'form-section', 'status-section', 'admin-login-section', 'admin-dashboard', 'report-section'];
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
    allSections.forEach(secId => {
        const el = document.getElementById(secId);
        if (el) el.classList.add('hidden');
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
    const target = document.getElementById(id);
    if (target) target.classList.remove('hidden');

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Header (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    const header = document.getElementById('main-header');
    if (header) header.classList.toggle('hidden', id === 'admin-dashboard');
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Reset)
function softReset() {
    showSection('home-section'); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    
    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ (‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
    const form = document.getElementById('appForm');
    if(form) form.reset();
    
    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    ['idCard-container', 'phone-container', 'checkIdCard-container'].forEach(id => setDig(id, ''));
    if(document.getElementById('province')) document.getElementById('province').innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>';
    ['district', 'subdistrict', 'status-result', 'oldPhoto', 'oldTs'].forEach(id => {
       const el = document.getElementById(id);
       if(el) el.innerHTML = '';
    });
    
    if(document.getElementById('isEditMode')) document.getElementById('isEditMode').value = 'false';
    if(document.getElementById('checkIdCard')) document.getElementById('checkIdCard').value = '';
    if(document.getElementById('newPhotoPreview')) document.getElementById('newPhotoPreview').style.display = 'none';
    
    aRole = 0; aName = ""; 
    if(document.getElementById('aUser')) document.getElementById('aUser').value = "";
    if(document.getElementById('aPass')) document.getElementById('aPass').value = "";
}

// 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö ‡∏°.1 / ‡∏°.4 (Manual Switch)
function switchTab(mode) {
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
    document.getElementById('btn-m1').className = 'btn btn-light text-muted rounded-pill w-50 fw-bold';
    document.getElementById('btn-m4').className = 'btn btn-light text-muted rounded-pill w-50 fw-bold';
    
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô
    document.getElementById('pane-m1').classList.remove('tab-active');
    document.getElementById('pane-m4').classList.remove('tab-active');

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
    document.getElementById('btn-' + mode).className = 'btn btn-primary rounded-pill w-50 fw-bold shadow-sm';
    
    // ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    document.getElementById('pane-' + mode).classList.add('tab-active');
}

// 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Render)
function showReport() {
    showSection('report-section');
    switchTab('m1'); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏°.1 ‡πÄ‡∏™‡∏°‡∏≠
    
    document.getElementById('stat-loading').classList.remove('hidden');
    document.getElementById('reportContent').classList.add('hidden');
    
    google.script.run.withSuccessHandler(renderReport).getPublicReport();
}

function renderReport(data) {
    document.getElementById('stat-loading').classList.add('hidden');
    document.getElementById('reportContent').classList.remove('hidden');

    if (data.error) { Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', data.error, 'error'); return; }

    let m1 = { list: [], stats: {} };
    let m4 = { list: [], stats: {} };
    let c1 = 0, c4 = 0;

    data.list.forEach(item => {
        if (item.level.includes("1")) {
            m1.list.push(item);
            m1.stats[item.plan] = (m1.stats[item.plan] || 0) + 1;
            c1++;
        } else if (item.level.includes("4")) {
            m4.list.push(item);
            m4.stats[item.plan] = (m4.stats[item.plan] || 0) + 1;
            c4++;
        }
    });

    document.getElementById('badge-m1').innerText = c1;
    document.getElementById('badge-m4').innerText = c4;

    const renderTab = (obj, type) => {
        // ‡∏ß‡∏≤‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        let statHtml = '';
        const plans = Object.keys(obj.stats).sort();
        const selectBox = document.getElementById(`filterPlan${type === 'm1' ? 'M1' : 'M4'}`);
        selectBox.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';

        plans.forEach(plan => {
            selectBox.innerHTML += `<option value="${plan}">${plan}</option>`;
            statHtml += `
            <div class="stat-item d-flex justify-content-between align-items-center p-2 bg-light rounded mb-2">
                <div class="small fw-bold text-dark text-wrap me-2">${plan}</div>
                <span class="badge bg-white text-primary border rounded-pill">${obj.stats[plan]}</span>
            </div>`;
        });
        document.getElementById(`stat-list-${type}`).innerHTML = statHtml || '<div class="text-center text-muted p-2 border border-dashed rounded">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';

        // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        let listHtml = '';
        obj.list.forEach(s => {
            let statusClass = 'bg-light text-secondary border';
            if (s.status.includes('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')) statusClass = 'bg-success bg-opacity-10 text-success border-success';
            else if (s.status.includes('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô') || s.status.includes('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç')) statusClass = 'bg-danger bg-opacity-10 text-danger border-danger';
            else if (s.status.includes('‡∏£‡∏≠')) statusClass = 'bg-warning bg-opacity-10 text-dark border-warning';

            listHtml += `
            <tr>
                <td class="ps-3">
                    <div class="fw-bold text-dark">${s.fullname}</div>
                    <div class="d-md-none text-muted small mt-1"><i class="bi bi-journal-bookmark"></i> ${s.plan}</div>
                </td>
                <td class="d-none d-md-table-cell text-secondary"><small>${s.plan}</small></td>
                <td class="text-center"><span class="status-pill ${statusClass}">${s.status}</span></td>
            </tr>`;
        });
        document.getElementById(`list-body-${type}`).innerHTML = listHtml || '<tr><td colspan="3" class="text-center py-4 text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</td></tr>';
    };

    renderTab(m1, 'm1');
    renderTab(m4, 'm4');
}

// 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Filter)
function filterTable(type) {
    const txt = document.getElementById(`search${type === 'm1' ? 'M1' : 'M4'}`).value.toLowerCase();
    const plan = document.getElementById(`filterPlan${type === 'm1' ? 'M1' : 'M4'}`).value;
    const rows = document.getElementById(`list-body-${type}`).getElementsByTagName('tr');

    for (let row of rows) {
        if(row.cells.length < 2) continue;
        const name = row.cells[0].textContent.toLowerCase();
        const planTxt = row.textContent; 
        row.style.display = (name.includes(txt) && (plan === "" || planTxt.includes(plan))) ? "" : "none";
    }
}


    // --- Strict Validation Listeners ---
    document.addEventListener('input', function(e) {
      // 1. ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ / ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ (‡∏Ñ‡∏•‡∏≤‡∏™ num-only) -> ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
      if (e.target.classList.contains('num-only')) {
         e.target.value = e.target.value.replace(/[^0-9]/g, '');
      }
      // 2. ‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠ (‡∏Ñ‡∏•‡∏≤‡∏™ text-only) -> ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
      if (e.target.classList.contains('text-only')) {
         e.target.value = e.target.value.replace(/[0-9]/g, '');
      }
    });


    // --- Helper: Convert Drive Link to Thumbnail ---
    function getDirectImg(url) {
       if(!url || url==='-') return 'https://via.placeholder.com/150?text=No+Image';
       try {
         let id = "";
         if(url.indexOf('id=') > -1) id = url.split('id=')[1].split('&')[0];
         else if(url.indexOf('/d/') > -1) id = url.split('/d/')[1].split('/')[0];
         if(id) return "https://drive.google.com/thumbnail?id=" + id + "&sz=w1000";
       } catch(e) { }
       return url;
    }

        

    // --- Init ---
    window.onload = () => {
       mkDig('idCard-container','idCard',13);
       mkDig('phone-container','phone',10);
       mkDig('checkIdCard-container','checkIdCard',13);
    };
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å (‡∏â‡∏ö‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö G ‡πÅ‡∏•‡∏∞‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ)
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å 13 ‡∏´‡∏•‡∏±‡∏Å (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡πÅ‡∏•‡∏∞ ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å (‡∏â‡∏ö‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î: G ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å + ‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏õ‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)
function mkDig(cid, hid, n) {
   const c = document.getElementById(cid);
   if (!c) return;
   c.innerHTML = '';
   
   // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
   const isID = cid.toLowerCase().includes('idcard');

   for (let i = 0; i < n; i++) {
     let ip = document.createElement('input');
     ip.className = 'digit-box';
     ip.maxLength = 1;
     
     // [‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ 1] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡πâ‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå
     // - ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ï‡∏£ (i==0) -> ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏õ‡πâ‡∏ô text (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå G)
     // - ‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -> ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏õ‡πâ‡∏ô numeric (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏á‡πà‡∏≤‡∏¢)
     if (isID && i === 0) {
        ip.setAttribute('inputmode', 'text');
     } else {
        ip.setAttribute('inputmode', 'numeric');
     }
     
     ip.oninput = (e) => {
        let val = e.target.value;
        
        if (isID) {
            // [‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ 2] ‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå G
            if (i === 0) {
                // ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏•‡∏Ç 0-9 ‡πÅ‡∏•‡∏∞ G, g
                val = val.replace(/[^0-9Gg]/g, '').toUpperCase();
            } else {
                // ‡∏ä‡πà‡∏≠‡∏á 2-13: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå G)
                val = val.replace(/[^0-9]/g, '');
            }
        } else {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á
            val = val.replace(/[^0-9]/g, '');
        }
        
        e.target.value = val;
        
        // ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        if (val && i < n - 1) c.children[i + 1].focus();
        
        upDig(cid, hid);
     };
     
     // ‡∏Å‡∏î Backspace ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏≠‡∏¢‡∏Å‡∏•‡∏±‡∏ö
     ip.onkeydown = (e) => {
        if (e.key === 'Backspace' && !e.target.value && i > 0) c.children[i - 1].focus();
     };
     
     c.appendChild(ip);
   }
}
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á G ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å)
function validateThaiID(id) {
  if (!id || id.length !== 13) return false;
  id = id.toUpperCase();

  // ‡∏Å‡∏£‡∏ì‡∏µ‡∏£‡∏´‡∏±‡∏™ G (G + 12 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) -> ‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏π‡∏ï‡∏£
  if (id.charAt(0) === 'G') {
      return /^\d{12}$/.test(id.substring(1));
  }

  // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢ (13 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) -> ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏π‡∏ï‡∏£
  if (!/^\d{13}$/.test(id)) return false;

  let sum = 0;
  for (let i = 0; i < 12; i++) {
    sum += parseFloat(id.charAt(i)) * (13 - i);
  }
  const checkDigit = (11 - sum % 11) % 10;
  return checkDigit === parseFloat(id.charAt(12));
}
    function upDig(cid,hid){ let v=''; document.querySelectorAll(`#${cid} input`).forEach(x=>v+=x.value); el(hid).value=v; }
    function setDig(cid,v){ document.querySelectorAll(`#${cid} input`).forEach((x,i)=>x.value=v[i]||''); upDig(cid,cid.replace('-container','')); }


    function openForm(type, ed=null) {
    loading(1); 
    el('appForm').reset(); 
    setDig('idCard-container',''); 
    setDig('phone-container','');
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    const isEd = !!ed; 
    el('isEditMode').value = isEd;
    el('submitBtn').innerText = isEd ? "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" : "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£";
    el('applyType').value = isEd ? ed[0] : (type==='special'?'‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©':'‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥'); // *‡πÅ‡∏Å‡πâ ed[2] ‡πÄ‡∏õ‡πá‡∏ô ed[0] ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ index ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á
    
    const isGen = el('applyType').value.includes('‡∏õ‡∏Å‡∏ï‡∏¥'); // ‡∏´‡∏£‡∏∑‡∏≠ '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö value
    isGen ? hide('ts-box') : show('ts-box');
    
    if(!isEd && !isGen) el('tsFile').setAttribute('required','true'); 
    else el('tsFile').removeAttribute('required');

    showSection('form-section');

    // --- ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---
    // ‡∏¢‡πâ‡∏≤‡∏¢ fillForm ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏≥‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î Address ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    google.script.run.withSuccessHandler(d => { 
        addrDB = d; 
        popProv(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
        initParentAddr(); // <--- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö! (‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á)
        
        if(isEd) {
            fillForm(ed); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å dropdown ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
        } else {
            loading(0);
        }
    }).getAddressData();
}
  function fillForm(d) {
    const el = (id) => document.getElementById(id);

    // ============================================
    // 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (Force Select)
    // ============================================
    el('editIdCard').value = d[13];
    let safeLevel = String(d[5] || "").trim();
    el('level').value = safeLevel; 

    if(typeof loadPlans === 'function') {
        loadPlans(d[6]); 
        try { el('level').dispatchEvent(new Event('change')); } catch(e){}
    }

    let planRetry = 0;
    const targetPlan = String(d[6] || "").trim();
    const planInterval = setInterval(() => {
        const planSelect = el('plan');
        if (planSelect && planSelect.options.length > 0) {
            planSelect.value = targetPlan;
            if (planSelect.value === targetPlan) {
                clearInterval(planInterval);
            } else if (planRetry > 20) {
                let opt = document.createElement('option');
                opt.value = targetPlan;
                opt.innerHTML = targetPlan + " (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°)";
                opt.selected = true;
                planSelect.appendChild(opt);
                clearInterval(planInterval);
            }
        }
        planRetry++;
        if (planRetry > 30) clearInterval(planInterval);
    }, 100);

    // --- 2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ---
    el('prefix').value = d[7]; 
    el('firstname').value = d[8]; 
    el('lastname').value = d[9]; 
    el('dob').value = d[10].replace(/'/g, '');
    el('nationality').value = d[11]; 
    el('religion').value = d[12];
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô setDig ‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ
    if(typeof setDig === 'function'){
      setDig('idCard-container', d[13].replace(/'/g, ''));
      setDig('phone-container', d[14].replace(/'/g, ''));
    } else {
      el('idCard').value = d[13].replace(/'/g, '');
      el('phone').value = d[14].replace(/'/g, '');
    }
    
    el('famStatus').value = d[16];

    // --- 3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß (‡∏ö‡∏¥‡∏î‡∏≤ f, ‡∏°‡∏≤‡∏£‡∏î‡∏≤ m, ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á g) ---
    // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 
    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏à‡∏∞‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á "‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" (addr_no) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error
    
    const fillParent = (p, startIdx) => {
    // 1. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    el(p+'_prefix').value = d[startIdx];
    el(p+'_name').value   = d[startIdx+1];
    el(p+'_lname').value  = d[startIdx+2];
    el(p+'_job').value    = d[startIdx+3];
    if(el(p+'_age')) el(p+'_age').value = d[startIdx+4] || '';
    el(p+'_phone').value = String(d[startIdx+5]).replace(/'/g, '');

    const fullAddr = String(d[startIdx+6] || "");
    
    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
    if(fullAddr.includes('‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö')) {
        el(p+'_same').checked = true;
        toggleAddr(p);
    } else {
        el(p+'_same').checked = false;
        toggleAddr(p);
        
        try {
            // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Logic ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô) ---
            
            // ‡∏î‡∏∂‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏á ‡∏à. ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
            const provMatch = fullAddr.match(/‡∏à\.?\s?([‡∏Å-‡πô]+)/) || fullAddr.match(/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î\s?([‡∏Å-‡πô]+)/);
            if (provMatch && el(p+'_addr_prov')) {
                const provName = provMatch[1].trim();
                el(p+'_addr_prov').value = provName;
                
                // ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
                chProvP(p); 

                setTimeout(() => {
                    // ‡∏î‡∏∂‡∏á‡∏≠‡∏≥‡πÄ‡∏†‡∏≠: ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏á ‡∏≠. ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
                    const distMatch = fullAddr.match(/‡∏≠\.?\s?([‡∏Å-‡πô]+)/) || fullAddr.match(/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠\s?([‡∏Å-‡πô]+)/);
                    if (distMatch && el(p+'_addr_dist')) {
                        const distName = distMatch[1].trim();
                        el(p+'_addr_dist').value = distName;
                        
                        // ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î ‡∏ï‡∏≥‡∏ö‡∏•
                        chDistP(p);

                        setTimeout(() => {
                            // ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡∏ö‡∏•: ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏á ‡∏ï. ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡∏≥‡∏ö‡∏•
                            const subMatch = fullAddr.match(/‡∏ï\.?\s?([‡∏Å-‡πô]+)/) || fullAddr.match(/‡∏ï‡∏≥‡∏ö‡∏•\s?([‡∏Å-‡πô]+)/);
                            if (subMatch && el(p+'_addr_sub')) {
                                el(p+'_addr_sub').value = subMatch[1].trim();
                                // ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå
                                chSubP(p);
                            }
                            
                            // ‡∏î‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô (‡∏Ñ‡∏≥‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ)
                            const addrNo = fullAddr.split(' ')[0];
                            el(p+'_addr_no').value = addrNo;
                            
                            // ‡∏î‡∏∂‡∏á‡∏´‡∏°‡∏π‡πà (‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‡∏´‡∏°‡∏π‡πà ‡∏´‡∏£‡∏∑‡∏≠ ‡∏°.)
                            const mooMatch = fullAddr.match(/‡∏´‡∏°‡∏π‡πà\s?(\d+)/) || fullAddr.match(/‡∏°\.(\d+)/);
                            if(mooMatch) el(p+'_addr_moo').value = mooMatch[1];
                            
                            // ‡∏î‡∏∂‡∏á‡∏ñ‡∏ô‡∏ô/‡∏ã‡∏≠‡∏¢ (‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡∏Ñ‡∏≥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á ‡∏´‡∏°‡∏π‡πà ‡∏Å‡∏±‡∏ö ‡∏ï‡∏≥‡∏ö‡∏•)
                            const roadMatch = fullAddr.match(/(?:‡∏ñ‡∏ô‡∏ô|‡∏ã‡∏≠‡∏¢|‡∏ñ\.|‡∏ã\.)\s?([‡∏Å-‡πô0-9\s]+)(?=‡∏ï\.|‡∏ï‡∏≥‡∏ö‡∏•)/);
                            if(roadMatch) el(p+'_addr_road').value = roadMatch[1].trim();
                            
                        }, 400);
                    }
                }, 400);
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢
                el(p+'_addr_no').value = fullAddr;
            }
        } catch (e) {
            console.error("Error parsing parent address:", e);
            el(p+'_addr_no').value = fullAddr;
        }
    }
}

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Column ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï
    fillParent('f', 17); // ‡∏ö‡∏¥‡∏î‡∏≤ ‡πÄ‡∏£‡∏¥‡πà‡∏° col 17
    fillParent('m', 24); // ‡∏°‡∏≤‡∏£‡∏î‡∏≤ ‡πÄ‡∏£‡∏¥‡πà‡∏° col 24 (‡∏ñ‡πâ‡∏≤‡πÅ‡∏ó‡∏£‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏≠‡∏≤‡∏à‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏•‡∏Ç index ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ)
    
    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á (Guardian) ---
    el('g_prefix').value = d[31];
    el('g_name').value = d[32];
    el('g_lname').value = d[33];
    el('g_rel').value = d[34];
    el('g_job').value = d[35];
    if(el('g_age')) el('g_age').value = d[36] || ''; 
    el('g_phone').value = String(d[37]).replace(/'/g, '');
    
    const gAddr = String(d[38] || "");
    if(gAddr.includes('‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö')) {
        el('g_same').checked = true;
        toggleAddr('g');
    } else {
        el('g_same').checked = false;
        toggleAddr('g');
        
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏á‡∏ä‡πà‡∏≠‡∏á ---
        try {
            // 1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
            const provMatch = gAddr.match(/‡∏à\.?\s?([‡∏Å-‡πô]+)/) || gAddr.match(/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î\s?([‡∏Å-‡πô]+)/);
            if (provMatch && el('g_addr_prov')) {
                const provName = provMatch[1].trim();
                el('g_addr_prov').value = provName;
                
                // ‡∏™‡∏±‡πà‡∏á‡πÇ‡∏´‡∏•‡∏î ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
                chProvP('g'); 

                setTimeout(() => {
                    // 2. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
                    const distMatch = gAddr.match(/‡∏≠\.?\s?([‡∏Å-‡πô]+)/) || gAddr.match(/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠\s?([‡∏Å-‡πô]+)/);
                    if (distMatch && el('g_addr_dist')) {
                        el('g_addr_dist').value = distMatch[1].trim();
                        
                        // ‡∏™‡∏±‡πà‡∏á‡πÇ‡∏´‡∏•‡∏î ‡∏ï‡∏≥‡∏ö‡∏•
                        chDistP('g');

                        setTimeout(() => {
                            // 3. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡∏ö‡∏•
                            const subMatch = gAddr.match(/‡∏ï\.?\s?([‡∏Å-‡πô]+)/) || gAddr.match(/‡∏ï‡∏≥‡∏ö‡∏•\s?([‡∏Å-‡πô]+)/);
                            if (subMatch && el('g_addr_sub')) {
                                el('g_addr_sub').value = subMatch[1].trim();
                                // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå
                                chSubP('g');
                            }
                            
                            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏´‡∏°‡∏π‡πà ‡∏ñ‡∏ô‡∏ô (‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πâ‡∏≠‡∏ô‡πÅ‡∏£‡∏Å)
                            const addrParts = gAddr.split(' ');
                            el('g_addr_no').value = addrParts[0] || ''; 
                            
                            const mooMatch = gAddr.match(/‡∏´‡∏°‡∏π‡πà\s?(\d+)/) || gAddr.match(/‡∏°\.(\d+)/);
                            if(mooMatch) el('g_addr_moo').value = mooMatch[1];
                            
                            const roadMatch = gAddr.match(/(?:‡∏ñ‡∏ô‡∏ô|‡∏ã‡∏≠‡∏¢|‡∏ñ\.|‡∏ã\.)\s?([‡∏Å-‡πô0-9\s]+)(?=‡∏ï\.|‡∏ï‡∏≥‡∏ö‡∏•)/);
                            if(roadMatch) el('g_addr_road').value = roadMatch[1].trim();
                            
                        }, 400);
                    }
                }, 400);
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢
                if(el('g_addr_no')) el('g_addr_no').value = gAddr;
            }
        } catch (e) {
            console.error("Error parsing guardian address:", e);
            if(el('g_addr_no')) el('g_addr_no').value = gAddr;
        }
    }

    // --- ‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ---
    if(d[d.length-4] && d[d.length-4]!='-') {
        el('oldPhoto').innerHTML=`<div class="alert alert-info py-1"><small>‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°: <a href="${d[d.length-4]}" target="_blank">‡∏î‡∏π‡∏£‡∏π‡∏õ</a></small></div><img src="${getDirectImg(d[d.length-4])}" class="img-thumbnail mt-1" style="max-height:100px;">`;
        show('oldPhoto'); el('photoFile').removeAttribute('required');
    }
    if(d[d.length-3] && d[d.length-3]!='-') { 
        el('oldTs').innerHTML=`<div class="alert alert-info py-1"><small>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°: <a href="${d[d.length-3]}" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π</a></small></div>`; 
        show('oldTs'); 
    }

    // --- 4. ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (JSON) ---
    let jsonAddr = d[d.length - 1]; 
    if (jsonAddr && typeof jsonAddr === 'string' && jsonAddr.startsWith('{')) {
        try {
            let addr = JSON.parse(jsonAddr);
            el('addrNo').value = addr.no || '';
            el('addrMoo').value = addr.moo || '';
            el('addrSoi').value = addr.soi || '';
            el('addrRoad').value = addr.road || '';

            el('province').value = addr.prov;
            el('province').dispatchEvent(new Event('change'));

            setTimeout(() => {
                el('district').value = addr.dist;
                el('district').dispatchEvent(new Event('change'));

                setTimeout(() => {
                    el('subdistrict').value = addr.sub;
                    if(addr.zip) el('zipcode').value = addr.zip;
                    loading(0); // ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                }, 500);
            }, 500);

        } catch (e) { console.error("JSON Error", e); loading(0); }
    } else {
        loading(0);
    }
}
   



    function loadPlans(sv) {
       const l = el('level').value; const t = el('applyType').value;
       if(!l) return;
       google.script.run.withSuccessHandler(p => {
          const s = el('plan'); s.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>';
          p.forEach(x => s.add(new Option(x,x)));
          if(sv) s.value = sv;
       }).getStudyPlans(l, t);
    }
    function popProv() { const p = [...new Set(addrDB.map(r=>r[0]))].sort(); const s = el('province'); s.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>'; p.forEach(x=>s.add(new Option(x,x))); }
    function chProv() { const pv=el('province').value; const d=el('district'); const sd=el('subdistrict'); el('zipcode').value=''; d.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>'; d.disabled=!pv; sd.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>'; sd.disabled=true; if(pv) [...new Set(addrDB.filter(r=>r[0]===pv).map(r=>r[1]))].sort().forEach(x=>d.add(new Option(x,x))); }
    function chDist() { const pv=el('province').value; const dt=el('district').value; const sd=el('subdistrict'); el('zipcode').value=''; sd.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>'; sd.disabled=!dt; if(dt) [...new Set(addrDB.filter(r=>r[0]===pv && r[1]===dt).map(r=>r[2]))].sort().forEach(x=>sd.add(new Option(x,x))); }
    function chSub() { const f=addrDB.find(r=>r[0]===el('province').value && r[1]===el('district').value && r[2]===el('subdistrict').value); if(f) el('zipcode').value=f[3]; }
   
    function toggleAddr(p) {
    const isSame = el(p+'_same').checked;
    const div = el(p+'_addr_div');

    // 1. ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
    // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å (isSame) ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô (none), ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏¥‡πä‡∏Å ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á (block)
    div.style.display = isSame ? 'none' : 'block';

    // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å (Required)"
    // ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà "‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô" ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á)
    const reqFields = ['no', 'sub', 'dist', 'prov']; 
    // ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏°‡∏π‡πà, ‡∏ñ‡∏ô‡∏ô)
    const allFields = ['no', 'moo', 'road', 'sub', 'dist', 'prov'];

    allFields.forEach(k => {
        // ‡∏´‡∏≤ element ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á: ‡πÄ‡∏ä‡πà‡∏ô f_addr_no, m_addr_prov
        const input = el(p+'_addr_'+k);
        
        if(input) {
            if (isSame) {
                // ‡∏Å‡∏£‡∏ì‡∏µ: ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà)
                input.value = '';                  // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á
                input.removeAttribute('required'); // ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Error ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏™‡πà‡∏á)
            } else {
                // ‡∏Å‡∏£‡∏ì‡∏µ: ‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà)
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏° attribute required ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
                if (reqFields.includes(k)) {
                    input.setAttribute('required', 'true');
                }
            }
        }
    });
}


    function copyP(f) {
    // 1. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏£‡∏ß‡∏° age)
    ['prefix','name','lname','job','age','phone'].forEach(k => {
        if(el(`g_${k}`) && el(`${f}_${k}`)) {
            el(`g_${k}`).value = el(`${f}_${k}`).value;
        }
    });

    // 2. ‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    el('g_rel').value = f==='f' ? '‡∏ö‡∏¥‡∏î‡∏≤' : '‡∏°‡∏≤‡∏£‡∏î‡∏≤';
    
    // 3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
    const srcSame = el(`${f}_same`).checked;
    el('g_same').checked = srcSame;
    
    // ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á Guardian ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡πä‡∏≠‡∏õ‡∏°‡∏≤
    toggleAddr('g');
    
    // 4. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏™‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢
    if(!srcSame) {
        // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πä‡∏≠‡∏õ (‡πÄ‡∏û‡∏¥‡πà‡∏° zip ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ)
        ['no','moo','road','prov','dist','sub','zip'].forEach(k => {
            const src = el(`${f}_addr_${k}`);
            const dst = el(`g_addr_${k}`);
            
            if(src && dst) {
                // ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏Ñ‡πà‡∏≤
                dst.value = src.value;
                
                // *‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç* ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Dropdown (prov, dist, sub) ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πä‡∏≠‡∏õ HTML (Option) ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏≤
                if(['prov','dist','sub'].includes(k)) {
                    dst.innerHTML = src.innerHTML; // ‡∏Å‡πä‡∏≠‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤
                    dst.value = src.value;         // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
                    dst.disabled = src.disabled;   // ‡∏Å‡πä‡∏≠‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ disabled
                }
            }
        });
    }
  }
    function readF(input, id) {
  // 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏´‡∏°
  if (input.files && input.files[0]) {
    var file = input.files[0];
    var fileName = file.name;
    var fileSize = file.size;
    var extension = fileName.split('.').pop().toLowerCase(); // ‡∏î‡∏∂‡∏á‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ

    // -----------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 10 MB
    // -----------------------------------------------------------
    if (fileSize > 10 * 1024 * 1024) { // 10 MB
      Swal.fire({
        icon: 'warning',
        title: '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î',
        text: '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB',
        confirmButtonColor: '#d63384'
      });
      input.value = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å
      return; // ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    }

    // -----------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
    // -----------------------------------------------------------
    
    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢ (‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å id ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤)
    if (id === 'photo64') {
      if (!['png', 'jpeg', 'jpg'].includes(extension)) {
         Swal.fire({
            icon: 'error',
            title: '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
            html: '‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏Å‡∏∏‡∏• <b>PNG ‡∏´‡∏£‡∏∑‡∏≠ JPEG</b> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
            confirmButtonColor: '#d63384'
         });
         input.value = ''; 
         return;
      }
    } 
    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏û.1 ‡∏´‡∏£‡∏∑‡∏≠ ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á)
    else {
      if (!['pdf', 'png', 'jpeg', 'jpg'].includes(extension)) {
         Swal.fire({
            icon: 'error',
            title: '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
            html: '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏Å‡∏∏‡∏• <b>PDF, PNG ‡∏´‡∏£‡∏∑‡∏≠ JPEG</b> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
            confirmButtonColor: '#d63384'
         });
         input.value = ''; 
         return;
      }
    }

    // -----------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏î‡∏¥‡∏°: ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Base64
    // -----------------------------------------------------------
    var reader = new FileReader();

    reader.onload = function(e) {
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Base64
      var pureBase64 = e.target.result.split(',')[1];
      var fileObj = {
        mimeType: file.type,
        data: pureBase64
      };
      
      // ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô Hidden Input
      var targetInput = document.getElementById(id);
      if (targetInput) {
          targetInput.value = JSON.stringify(fileObj);
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ (Preview) ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢
      if (id === 'photo64') {
        const previewContainer = document.getElementById('newPhotoPreview');
        const previewImg = document.getElementById('imgPreview');
        const oldPhoto = document.getElementById('oldPhoto');

        if (previewImg) {
          previewImg.src = e.target.result; // ‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô tag img
          if (previewContainer) previewContainer.style.display = 'block'; // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á div
          if (oldPhoto) oldPhoto.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        }
      }
    };

    reader.readAsDataURL(file);
  }
}
   
  function handleSubmit(e) {
    e.preventDefault();

    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏û‡∏±‡∏Å‡πÑ‡∏ß‡πâ
    const idCardVal = el('idCard').value.trim(); // ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
    const phoneVal = el('phone').value.trim();
    const selectedPlan = el('plan').value;
    
    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SMTE (‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ G) ---
    const strictPlans = [
       // "SMTE (‡∏ß‡∏¥‡∏ó‡∏¢‡πå-‡∏Ñ‡∏ì‡∏¥‡∏ï-‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ-‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°)",
        "‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° (SMTE)"
    ];

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å SMTE ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ G) -> ‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£
    if (strictPlans.includes(selectedPlan) && !/^\d+$/.test(idCardVal)) {
        return Swal.fire(
            '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
            '‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô SMTE ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
            'warning'
        );
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ ---
    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡πâ‡∏ß‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å (‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢) -> ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
    if (/^\d{13}$/.test(idCardVal)) {
        if (!validateThaiID(idCardVal)) {
            Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Check Digit ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô)', 'error');
            loading(0);
            return;
        }
    } 
    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ G (‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß) -> ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
    else if (idCardVal.toUpperCase().startsWith('G')) {
         // ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™ G ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏è)
         if(idCardVal.length < 10) { 
             return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏£‡∏´‡∏±‡∏™ G ‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ', 'error');
         }
    } 
    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 3: ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ß‡∏Å‡πÄ‡∏•‡∏¢
    else {
         return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™ G ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ---
    if (phoneVal.length != 10) {
        return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 10 ‡∏´‡∏•‡∏±‡∏Å)', 'warning');
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Logic ‡πÄ‡∏î‡∏¥‡∏°) ---
    Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: '‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£',
        cancelButtonText: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç'
    }).then(r => {
        if (r.isConfirmed) {
            startSimulatedProgress();

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á
            const getP = (p) => {
                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏¢: ‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
                const buildAddr = () => {
                    if (el(p + '_same').checked) return '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';

                    const no = el(p + '_addr_no') ? el(p + '_addr_no').value.trim() : '';
                    const moo = el(p + '_addr_moo') ? el(p + '_addr_moo').value.trim() : '';
                    const road = el(p + '_addr_road') ? el(p + '_addr_road').value.trim() : '';
                    const sub = el(p + '_addr_sub') ? el(p + '_addr_sub').value.trim() : '';
                    const dist = el(p + '_addr_dist') ? el(p + '_addr_dist').value.trim() : '';
                    const prov = el(p + '_addr_prov') ? el(p + '_addr_prov').value.trim() : '';
                    const zip = el(p + '_addr_zip') ? el(p + '_addr_zip').value.trim() : '';

                    let full = `${no}`;
                    if (moo) full += ` ‡∏´‡∏°‡∏π‡πà ${moo}`;
                    if (road) full += ` ‡∏ñ‡∏ô‡∏ô ${road}`;
                    if (sub) full += ` ‡∏ï.${sub}`;
                    if (dist) full += ` ‡∏≠.${dist}`;
                    if (prov) full += ` ‡∏à.${prov}`;
                    if (zip) full += ` ${zip}`;

                    return full.trim();
                };

                return {
                    prefix: el(p + '_prefix').value,
                    name: el(p + '_name').value,
                    lname: el(p + '_lname').value,
                    job: el(p + '_job').value,
                    age: el(p + '_age').value,
                    phone: el(p + '_phone').value,
                    rel: el(p + '_rel') ? el(p + '_rel').value : '',
                    addr: buildAddr()
                };
            };

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Object ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á
            const fd = {
                isEditMode: el('isEditMode').value === 'true',
                editIdCard: el('editIdCard').value,
                applyType: el('applyType').value,
                level: el('level').value,
                plan: el('plan').value,
                prefix: el('prefix').value,
                firstname: el('firstname').value,
                lastname: el('lastname').value,
                firstnameEn: el('firstnameEn').value,
                lastnameEn: el('lastnameEn').value,
                oldSchoolName: el('oldSchoolName').value,
                oldSchoolProvince: el('oldSchoolProvince').value,
                dob: el('dob').value,
                nationality: getVal('nationality', 'nationality_other'),
                religion: getVal('religion', 'religion_other'),
                idCard: idCardVal, // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà Trim ‡πÅ‡∏•‡πâ‡∏ß
                phone: phoneVal,
                addrNo: el('addrNo').value,
                addrMoo: el('addrMoo').value,
                addrSoi: el('addrSoi').value,
                addrRoad: el('addrRoad').value,
                province: el('province').value,
                district: el('district').value,
                subdistrict: el('subdistrict').value,
                zipcode: el('zipcode').value,
                famStatus: el('famStatus').value,
                father: getP('f'),
                mother: getP('m'),
                guardian: getP('g'),
                photoFile: JSON.parse(el('photo64').value || '{}'),
                transcriptFile: el('ts64').value ? JSON.parse(el('ts64').value) : null,
                conductFile: el('conduct64').value ? JSON.parse(el('conduct64').value) : null
            };

            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Apps Script
           google.script.run
                .withSuccessHandler(res => {
                    // 2. [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏™‡∏±‡πà‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡πÇ‡∏ä‡∏ß‡πå 100% (‡πÅ‡∏ó‡∏ô loading(0))
                    stopSimulatedProgress();
                    
                    if (res.success) {
                        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', res.message, 'success').then(() => softReset());
                    } else {
                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', res.message, 'error');
                    }
                })
                .withFailureHandler(err => {
                    // 3. [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏ñ‡πâ‡∏≤ Error ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
                    stopSimulatedProgress();
                    Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
                })
                .submitApplication(fd);
        }
    });
}
    function getVal(selectId, inputId) {
     const val = document.getElementById(selectId).value;
     if(val === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
        return document.getElementById(inputId).value; 
     }
     return val;
    }

    function doCheck() {
    const id = el('checkIdCard').value;
    if(id.length!==13) return Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ 13 ‡∏´‡∏•‡∏±‡∏Å','warning');
    
    loading(1);
    
    google.script.run.withSuccessHandler(r => {
        loading(0); 
        const d = el('status-result');
        
        if(r.found) {
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
            foundStudentData = r; 

            const b = r.status==='‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'bg-success' : (r.status.includes('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö') ? 'bg-warning' : 'bg-danger');
            
            // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° Action ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ---
            let actionBtn = "";
            
            if (r.status === '‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•') {
                // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                actionBtn = `<button class="btn btn-warning w-100 mt-2 rounded-pill shadow-sm" onclick='openForm(null, ${JSON.stringify(r.fullData)})'>
                                <i class="bi bi-pencil me-1"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                             </button>`;
            } else if (r.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') {
                // ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≠‡∏ö (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å printCardUser)
                actionBtn = `<button class="btn btn-primary w-100 mt-2 rounded-pill shadow-sm" onclick="printCardUser(foundStudentData)">
                                <i class="bi bi-printer-fill me-1"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏™‡∏≠‡∏ö
                             </button>`;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö
            let seatHtml = "";
            if (r.seatNo && String(r.seatNo).trim() !== "") {
                seatHtml = `<div class="alert alert-info mt-2 fw-bold text-center" style="font-size: 1.1rem;">
                               <i class="bi bi-ticket-perforated"></i> ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö: ${r.seatNo}
                            </div>`;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            d.innerHTML = `<div class="card shadow-sm">
                    <div class="card-header ${b} text-white fw-bold">${r.status}</div>
                    <div class="card-body">
                        <h5>${r.name}</h5>
                        <p class="mb-1 text-muted">${r.applyType}</p>
                        ${seatHtml} 
                        ${r.reason ? `<div class="alert alert-danger py-1 small mt-2">${r.reason}</div>` : ''}
                        
                        <div class="mt-3 border-top pt-2">
                            ${actionBtn}
                        </div>
                    </div>
                  </div>`;
                  
        } else {
            d.innerHTML = '<div class="alert alert-secondary text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
        }
    }).withFailureHandler(alertErr).checkStatus(id);
}


    // --- Admin ---
    function doLogin() {
    loading(1); // ‡πÅ‡∏™‡∏î‡∏á Loading
    
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Server Login
    google.script.run.withSuccessHandler(r => {
        loading(0); // ‡∏õ‡∏¥‡∏î Loading
        
        if (r.success) {
            // 1. ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
            aRole = r.role; 
            aName = r.name; 
            if(document.getElementById('aName')) document.getElementById('aName').innerText = aName;

            // 2. üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
            // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏£‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á showSection)
            try {
                document.getElementById('admin-login-section').classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô Login
                document.getElementById('admin-dashboard').classList.remove('hidden');  // ‡πÅ‡∏™‡∏î‡∏á Dashboard
            } catch(e) { 
                console.error("‡∏´‡∏≤ ID ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠: ", e);
                alert("Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏´‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠");
            }

            // 3. ‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á (‡∏ñ‡πâ‡∏≤ Error ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Login)
            try {
                loadAdm(); 
                loadAdminStatus();
            } catch(e) {
                console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ", e);
            }

        } else {
            alertErr(r.message); // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î
        }
    }).withFailureHandler(err => {
        loading(0);
        alertErr("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err);
    }).adminLogin(el('aUser').value, el('aPass').value);
}
   
    function loadAdm() {
    // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
    const tbody = document.querySelector('#aTable tbody');
    if(tbody) tbody.innerHTML = '<tr><td colspan="3" class="text-center py-5 text-muted">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

    google.script.run.withSuccessHandler(r => {
        console.log("Data form Server:", r); // ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Console ‡πÑ‡∏î‡πâ

        // 2. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        if (!r) {
            console.error("Server ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô null");
            return;
        }

        // 3. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ allSt (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô)
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Object {students: [...]} ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Array [...] ‡∏ï‡∏£‡∏á‡πÜ
        if (r.students) {
            allSt = r.students;
            // --- [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---
        const planSet = new Set(allSt.map(s => s.plan).filter(Boolean)); // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≥
        const planSelect = document.getElementById('planFilter');
        
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô (‡∏Å‡∏£‡∏ì‡∏µ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
        const oldVal = planSelect.value;
        
        planSelect.innerHTML = '<option value="all">üìñ ‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
        [...planSet].sort().forEach(p => {
             planSelect.add(new Option(p, p));
        });
        
        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        if ([...planSet].includes(oldVal)) planSelect.value = oldVal;

        } else if (Array.isArray(r)) {
            allSt = r; // ‡∏Å‡∏£‡∏ì‡∏µ Server ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Array ‡∏ï‡∏£‡∏á‡πÜ
        } else {
            allSt = [];
        }

        // 4. üî• ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡πÉ‡∏™‡πà if ‡∏î‡∏±‡∏Å‡πÑ‡∏ß‡πâ ‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)
        if (r.stats) {
            if(document.getElementById('st-total')) document.getElementById('st-total').innerText = r.stats.total;
            if(document.getElementById('st-pend')) document.getElementById('st-pend').innerText = r.stats.pending;
            if(document.getElementById('st-app')) document.getElementById('st-app').innerText = r.stats.approved;
        }

        // 5. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
        try {
            filterTbl(); 
        } catch (e) {
            console.error("‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", e);
        }

        // üî• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏£‡∏±‡∏ö
        try { 
             updateCharts(); 
        } catch (e) { 
             console.warn("‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", e); 
        }

        // 6. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü)
        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏£‡∏≤‡∏ü ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏ä‡πà‡∏ô updateCharts(allSt);

    }).withFailureHandler(err => {
        alertErr(err);
        if(tbody) tbody.innerHTML = `<tr><td colspan="3" class="text-center text-danger">Error: ${err}</td></tr>`;
    }).getAdminData();
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü
function updateCharts() {
    if (!allSt || allSt.length === 0) return;

    // 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    let planCounts = {};
    let statusCounts = { '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': 0, '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö': 0, '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô': 0 };

    allSt.forEach(s => {
        // ‡∏ô‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        let p = s.plan || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        planCounts[p] = (planCounts[p] || 0) + 1;

        // ‡∏ô‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let st = s.status || '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
        if (st === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') statusCounts['‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥']++;
        else if (st.includes('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô') || st.includes('‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á')) statusCounts['‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô']++;
        else statusCounts['‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö']++;
    });

    // 2. [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
    let sortedPlanArr = Object.entries(planCounts).sort((a, b) => b[1] - a[1]);
    let sortedPlanObj = {};
    sortedPlanArr.forEach(([key, val]) => sortedPlanObj[key] = val);

    // 3. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü
    if (typeof Chart !== 'undefined') {
        // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
        drawChartHorizontal('chartPlan', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (‡∏Ñ‡∏ô)', sortedPlanObj);
        
        // ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
        drawChart('chartStatus', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£', statusCounts, 'doughnut');
    }
}
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏î‡πâ
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô ‡πÅ‡∏ö‡∏ö‡∏°‡∏µ Scroll Bar (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á)
function drawChartHorizontal(canvasId, label, dataObj) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;

    // 1. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏î‡∏¥‡∏° (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
    if (myCharts[canvasId]) {
        myCharts[canvasId].destroy();
        delete myCharts[canvasId];
    }

    const labels = Object.keys(dataObj);
    const data = Object.values(dataObj);
    
    // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô (‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ó‡πà‡∏á‡∏™‡∏π‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 35px + ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö
    // ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 300px ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
    const rowHeight = 35; 
    const minHeight = 300;
    const contentHeight = Math.max(minHeight, labels.length * rowHeight);

    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß Canvas ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡∏™‡πà‡∏ß‡∏ô div ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Scroll ‡πÄ‡∏≠‡∏á)
    canvas.style.height = contentHeight + 'px';
    canvas.style.width = '100%'; // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°

    // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
    const ctx = canvas.getContext('2d');
    myCharts[canvasId] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                backgroundColor: 'rgba(54, 162, 235, 0.7)', // ‡∏™‡∏µ‡∏ü‡πâ‡∏≤
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
                barThickness: 20, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
            }]
        },
        options: {
            indexAxis: 'y', // ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô
            maintainAspectRatio: false, // ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            responsive: true,
            animation: false, // ‡∏õ‡∏¥‡∏î Animation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: { label: (c) => ` ${c.formattedValue} ‡∏Ñ‡∏ô` }
                }
            },
            scales: {
                x: { 
                    beginAtZero: true,
                    ticks: { stepSize: 1 } // ‡πÅ‡∏Å‡∏ô X ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°
                },
                y: {
                    ticks: { 
                        autoSkip: false, // ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        font: { size: 14 }
                    },
                    grid: { display: false } // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤
                }
            }
        }
    });
}
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
function viewS(rowIndex) {
    const s = allSt.find(item => item.rowIndex == rowIndex);
    if (!s) return;

    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Debug) ---
    // ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á‡∏ö‡∏≠‡∏Å‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏´‡πá‡∏ô ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô Code.gs ‡∏ú‡∏¥‡∏î‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö
    // alert("‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠:\n" + s.photo); 
    // ------------------------------------

    if(document.getElementById('vName')) document.getElementById('vName').innerText = s.name || '-';
    if(document.getElementById('vIdCard')) document.getElementById('vIdCard').innerText = s.idCard || '-';
    if(document.getElementById('vLevel')) document.getElementById('vLevel').innerText = s.level || '-';
    if(document.getElementById('vPlan')) document.getElementById('vPlan').innerText = s.plan || '-';
    
    // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    const stBadge = document.getElementById('vStatus');
    if(stBadge) {
        stBadge.innerText = s.status || '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
        stBadge.className = 'badge fs-6 ' + (s.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'bg-success' : s.status.includes('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô') ? 'bg-danger' : 'bg-warning text-dark');
    }

    // ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
    const imgEl = document.getElementById('vPhoto');
    let photoUrl = s.photo || '';
    
    // ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á ID
    let fileIdMatch = photoUrl.match(/[-\w]{25,}/);
    
    if (fileIdMatch) {
        // ‡πÄ‡∏à‡∏≠ ID ‡∏£‡∏π‡∏õ -> ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ
        imgEl.src = "https://drive.google.com/thumbnail?id=" + fileIdMatch[0] + "&sz=w400";
        imgEl.style.display = 'block';
    } else {
        // ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏£‡∏π‡∏õ -> ‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡∏ß‡πà‡∏≤‡∏á
        console.log("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏¥‡∏î format:", photoUrl);
        imgEl.src = 'https://via.placeholder.com/200?text=No+Photo';
    }

    // ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
    const btnDoc = document.getElementById('vTranscript');
    if(btnDoc) {
        if (s.transcript && s.transcript.length > 5) {
            btnDoc.href = s.transcript;
            btnDoc.classList.remove('disabled', 'btn-secondary');
            btnDoc.classList.add('btn-primary');
            btnDoc.innerHTML = '<i class="bi bi-file-earmark-pdf"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÉ‡∏ö ‡∏õ‡∏û.1';
        } else {
            btnDoc.href = '#';
            btnDoc.classList.add('disabled', 'btn-secondary');
            btnDoc.classList.remove('btn-primary');
            btnDoc.innerHTML = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£';
        }
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥ ---
    const btnConduct = document.getElementById('vConduct'); // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ID ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
    if(btnConduct) {
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏´‡∏° (‡πÅ‡∏•‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
        if (s.conduct && s.conduct.length > 5) {
            btnConduct.href = s.conduct;
            btnConduct.target = "_blank"; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
            btnConduct.classList.remove('disabled', 'btn-secondary');
            btnConduct.classList.add('btn-info', 'text-white'); // ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡∏ü‡πâ‡∏≤
            btnConduct.innerHTML = '<i class="bi bi-file-person"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥';
            btnConduct.style.display = 'inline-block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°
        } else {
            btnConduct.href = '#';
            btnConduct.classList.add('disabled', 'btn-secondary');
            btnConduct.classList.remove('btn-info', 'text-white');
            btnConduct.innerHTML = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ø';
            // btnConduct.style.display = 'none'; // ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå
        }
    }

    

    new bootstrap.Modal(document.getElementById('studentModal')).show();
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü (‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ)
let myCharts = {}; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
function drawChart(canvasId, label, dataObj, type) {
    const ctx = document.getElementById(canvasId);
    if (!ctx) return;

    // ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô (‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏∞‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)
    if (myCharts[canvasId]) myCharts[canvasId].destroy();

    myCharts[canvasId] = new Chart(ctx, {
        type: type,
        data: {
            labels: Object.keys(dataObj),
            datasets: [{
                label: label,
                data: Object.values(dataObj),
                backgroundColor: [
                    '#36a2eb', '#ff6384', '#ffcd56', '#4bc0c0', '#9966ff', '#ff9f40'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}
   
    function filterStatus(st) { el('aSearch').value = st; filterTbl(); }

    function logout() {
    // 1. ‡∏ã‡πà‡∏≠‡∏ô Dashboard
    document.getElementById('admin-dashboard').classList.add('hidden');
    
    // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ Login
    document.getElementById('admin-login-section').classList.remove('hidden');
    
    // 3. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
    if(document.getElementById('aPass')) document.getElementById('aPass').value = '';
    
    // 4. ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Optional)
    allSt = [];
}

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Search & Filter)
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô + ‡∏Å‡∏£‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô + Responsive Table
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡∏≠‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô)
function filterTbl() {
    const tbody = document.querySelector('#aTable tbody');
    if (!tbody) return;
    
    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
    tbody.innerHTML = ''; 

    // 1. ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
    let txt = document.getElementById('searchBox').value.trim().toLowerCase();
    let stFilter = document.getElementById('statusFilter').value;
    let lvFilter = document.getElementById('levelFilter').value; 
    let pln = document.getElementById('planFilter').value; // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    let maxRows = document.getElementById('rowsFilter').value;

    // 2. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Filter Data)
    let filteredData = allSt.filter(s => {
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£)
        let matchText = (s.name.toLowerCase().includes(txt) || s.idCard.includes(txt));
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let matchStatus = true;
        if (stFilter !== 'all') {
            if (stFilter === '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô') matchStatus = s.status.includes('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô') || s.status.includes('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç') || s.status.includes('‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á');
            else matchStatus = s.status.includes(stFilter);
        }

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô
        let matchLevel = true;
        if (lvFilter !== 'all') {
            let levelData = (s.level || '').toString(); 
            if (lvFilter === '‡∏°.1') {
                matchLevel = levelData.includes('1');
            } else if (lvFilter === '‡∏°.4') {
                matchLevel = levelData.includes('4');
            } else {
                matchLevel = levelData.includes(lvFilter);
            }
        }

        // ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        const matchPlan = (pln === 'all') || (s.plan === pln);

        // ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
        return matchText && matchStatus && matchLevel && matchPlan;
    });

    // 3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    if (filteredData.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3" class="text-center text-muted py-5">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</td></tr>`;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏™‡∏î‡∏á 0)
        let countDisplay = document.getElementById('countDisplay');
        if(countDisplay) countDisplay.innerText = `‡πÅ‡∏™‡∏î‡∏á 0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${allSt.length})`;
        
        return;
    }

    // 4. ‡∏ï‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    let displayData = filteredData;
    if (maxRows !== 'all') { // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 'all' ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö value ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô 1000 ‡∏´‡∏£‡∏∑‡∏≠ 'all')
        // ‡∏ñ‡πâ‡∏≤ value ‡πÉ‡∏ô HTML ‡πÄ‡∏õ‡πá‡∏ô '1000' ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ parseInt
        if(!isNaN(parseInt(maxRows))) {
             displayData = filteredData.slice(0, parseInt(maxRows));
        }
    }

    // 5. ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Loop ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML)
    displayData.forEach(s => {
        let badgeClass = 'bg-secondary';
        if (s.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') badgeClass = 'bg-success';
        else if (s.status.includes('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô') || s.status.includes('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç')) badgeClass = 'bg-danger';
        else badgeClass = 'bg-warning text-dark';

        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤ null/undefined ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
        let pName = (s.fullData && s.fullData[31] ? s.fullData[31] : '') + 
                    (s.fullData && s.fullData[32] ? s.fullData[32] : '') + ' ' + 
                    (s.fullData && s.fullData[33] ? s.fullData[33] : '');
        let pTel = (s.fullData && s.fullData[36]) ? s.fullData[36] : '-';

        let row = `
            <tr class="align-top border-bottom">
                <td class="p-2 p-md-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-bold text-primary fs-5">${s.name}</div>
                            <span class="badge bg-light text-dark border me-1">${s.level}</span>
                            <span class="badge bg-light text-dark border">${s.plan}</span>
                        </div>
                    </div>
                    <div class="mt-2 small text-muted bg-light p-2 rounded border">
                        <div><i class="bi bi-card-heading"></i> ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£: ${s.idCard}</div>
                        <div class="mt-1"><i class="bi bi-people-fill"></i> ‡∏ú‡∏õ‡∏Ñ: ${pName} (<a href="tel:${pTel}">${pTel}</a>)</div>
                    </div>
                </td>
                <td class="text-center pt-3" style="min-width: 100px;">
                    <span class="badge rounded-pill ${badgeClass} fs-6 w-100">${s.status}</span>
                    <div class="mt-2 small text-muted" style="font-size: 0.75rem;">${s.timestamp.split(' ')[0]}</div>
                </td>
                <td class="text-center pt-3">
                     <button class="btn btn-outline-primary btn-sm" onclick="viewS(${s.rowIndex})">
                        <i class="bi bi-eye-fill"></i><span class="d-none d-md-inline"> ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                     </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ element id="countDisplay")
    let countDisplay = document.getElementById('countDisplay');
    if(countDisplay) {
        countDisplay.innerText = `‡πÅ‡∏™‡∏î‡∏á ${displayData.length} ‡∏à‡∏≤‡∏Å ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${allSt.length})`;
    }
}
    function viewS(i) {
    curIdx = i;
    const s = allSt.find(x => x.rowIndex === i);
    let photoSrc = getDirectImg(s.photo);

    // 1. ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥
    let btnConduct = (s.conduct && s.conduct.length > 5) 
        ? `<a href="javascript:void(0)" onclick="previewDoc('${s.conduct}')" class="btn btn-sm btn-outline-info mt-1 w-100"><i class="bi bi-file-person"></i> ‡∏î‡∏π‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥</a>`
        : `<button class="btn btn-sm btn-light mt-1 w-100 text-muted" disabled>‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥</button>`;

    // 2. ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏™‡∏≠‡∏ö (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô)
    let btnPrint = `<button onclick="printCard(${s.rowIndex})" class="btn btn-sm btn-success mt-2 w-100"><i class="bi bi-printer-fill"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏™‡∏≠‡∏ö</button>`;

    // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏£‡∏ß‡∏° (‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ h ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
    let h = `<div class="row">
       <div class="col-md-4 text-center mb-3">
          <div class="card shadow-sm p-2">
             <img src="${photoSrc}" class="img-fluid rounded" style="max-height:200px; object-fit:cover;">
             <div class="mt-2 fw-bold text-primary">${s.appId}</div>
          </div>
          
          <a href="javascript:void(0)" onclick="previewDoc('${s.transcript}')" class="btn btn-sm btn-outline-dark mt-2 w-100"><i class="bi bi-file-earmark-text"></i> ‡∏î‡∏π‡πÉ‡∏ö ‡∏õ‡∏û.1</a>
          ${btnConduct}
          ${btnPrint} </div>
       <div class="col-md-8">
          <h5 class="fw-bold text-primary border-bottom pb-2">${s.name}</h5>
          <table class="table table-sm table-borderless">
            <tr><th width="30%">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</th><td>${s.idCard}</td></tr>
            <tr><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</th><td>${s.level}</td></tr>
            <tr><th>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</th><td>${s.plan}</td></tr>
            <tr><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</th><td><span class="badge bg-secondary">${s.status}</span></td></tr>
            <tr class="table-light"><th colspan="2" class="pt-2 text-muted">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</th></tr>
            <tr><td colspan="2">${s.fullData[31]}${s.fullData[32]} ${s.fullData[33]} (${s.fullData[34]})<br>‡πÇ‡∏ó‡∏£: <a href="tel:${s.fullData[36]}">${s.fullData[36]}</a></td></tr>
          </table>
          ${s.reason ? `<div class="alert alert-danger py-1"><small><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> ${s.reason}</small></div>` : ''}
       </div>
    </div>`;

    // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    el('mBody').innerHTML = h;
    if (!myModal) { myModal = new bootstrap.Modal(el('sModal'), { focus: false }); }
    myModal.show();
}
    function upSt(s) {
    Swal.fire({
        title: '‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏',
        input: 'text',
        inputPlaceholder: '(‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)',
        showCancelButton: true,
        confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'
    }).then(r => {
        if (r.isConfirmed) {
            // 1. ‡πÅ‡∏™‡∏î‡∏á Loading ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏•‡∏Ç
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö',
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading()
            });

            // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
            google.script.run
                .withSuccessHandler((res) => {
                    // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    if (myModal) myModal.hide();
                    loadAdm(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‚ö†Ô∏è) ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Warning, ‡∏ñ‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô Success
                    let iconType = (res && res.message && res.message.includes('‚ö†Ô∏è')) ? 'warning' : 'success';
                    let msgText = (res && res.message) ? res.message : '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß';

                    Swal.fire({
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: msgText, // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö
                        icon: iconType
                    });
                })
                .withFailureHandler((error) => {
                    // 3. ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î Error (‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏µ‡∏¢‡∏ö)
                    console.error("Error:", error);
                    Swal.fire({
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        html: '‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤: <span style="color:red">' + error.message + '</span>',
                        icon: 'error'
                    });
                })
                .updateStudentStatus(curIdx, s, r.value, aName);
        }
    });
}


    // --- Stats Logic ---
    function openStats() {
       if (!statModal) { statModal = new bootstrap.Modal(el('statModal')); }
       statModal.show();
       
       // Prepare Data
       let plans = {};
       let status = {'‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö':0, '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥':0, '‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•':0, '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å':0};
       
       allSt.forEach(s => {
          // Count Plans
          let k = s.level + " " + s.plan;
          if(!plans[k]) plans[k] = 0;
          plans[k]++;
         
          // Count Status
          let st = s.status.split(' (')[0]; // Remove (Editor Name)
          if(status[st] !== undefined) status[st]++;
          else status['‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö']++;
       });


       // Draw Charts
       drawPlanChart(plans);
       drawStatusChart(status);
    }


    function drawPlanChart(data) {
       const ctx = el('chartPlan').getContext('2d');
       if(cPlan) cPlan.destroy();
       cPlan = new Chart(ctx, {
          type: 'bar',
          data: {
             labels: Object.keys(data),
             datasets: [{
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£',
                data: Object.values(data),
                backgroundColor: 'rgba(13, 110, 253, 0.7)',
                borderColor: 'rgba(13, 110, 253, 1)',
                borderWidth: 1
             }]
          },
          options: { responsive: true, scales: { y: { beginAtZero: true } } }
       });
    }


    function drawStatusChart(data) {
       const ctx = el('chartStatus').getContext('2d');
       if(cStatus) cStatus.destroy();
       cStatus = new Chart(ctx, {
          type: 'doughnut',
          data: {
             labels: Object.keys(data),
             datasets: [{
                data: Object.values(data),
                backgroundColor: ['#ffc107', '#198754', '#0dcaf0', '#dc3545']
             }]
          },
          options: { responsive: true }
       });
    }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á (Parent Address System) ---

// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏™‡πà Dropdown (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö)
function initParentAddr() {
    if(!addrDB || addrDB.length === 0) {
        console.error("‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (addrDB) ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î");
        return;
    }

    // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Unique)
    const provs = [...new Set(addrDB.map(x => x[0]))].sort();
    
    // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á ‡∏ö‡∏¥‡∏î‡∏≤(f), ‡∏°‡∏≤‡∏£‡∏î‡∏≤(m), ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á(g)
    ['f', 'm', 'g'].forEach(p => {
        const sel = document.getElementById(p + '_addr_prov');
        if(sel) {
            sel.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>'; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤
            provs.forEach(pv => {
                const opt = new Option(pv, pv);
                sel.add(opt);
            });
            console.log("‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡πâ: " + p + " ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        } else {
            console.warn("‡πÑ‡∏°‡πà‡∏û‡∏ö Element ID: " + p + "_addr_prov");
        }
    });
    initOldSchoolProv();
}
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏¥‡∏°"
function initOldSchoolProv() {
  const select = document.getElementById('oldSchoolProvince');
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!select || !addrDB || addrDB.length === 0) return;

  // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>';

  // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)
  const provs = [...new Set(addrDB.map(x => x[0]))].sort();

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô Dropdown
  provs.forEach(p => {
    let opt = document.createElement('option');
    opt.value = p;
    opt.innerHTML = p;
    select.appendChild(opt);
  });
}
// 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î -> ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏≥‡πÄ‡∏†‡∏≠
function chProvP(p) {
    const prov = document.getElementById(p + '_addr_prov').value;
    const distSel = document.getElementById(p + '_addr_dist');
    const subSel = document.getElementById(p + '_addr_sub');
    const zipInp = document.getElementById(p + '_addr_zip');

    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
    distSel.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï</option>';
    subSel.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á</option>';
    zipInp.value = '';
    distSel.disabled = true;
    subSel.disabled = true;

    if (prov) {
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏±‡πâ‡∏ô
        const dists = [...new Set(addrDB.filter(x => x[0] === prov).map(x => x[1]))].sort();
        dists.forEach(d => distSel.add(new Option(d, d)));
        distSel.disabled = false;
    }
}

// 3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ -> ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≥‡∏ö‡∏•
function chDistP(p) {
    const prov = document.getElementById(p + '_addr_prov').value;
    const dist = document.getElementById(p + '_addr_dist').value;
    const subSel = document.getElementById(p + '_addr_sub');
    const zipInp = document.getElementById(p + '_addr_zip');

    subSel.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á</option>';
    zipInp.value = '';
    subSel.disabled = true;

    if (dist) {
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ô‡∏±‡πâ‡∏ô
        const subs = [...new Set(addrDB.filter(x => x[0] === prov && x[1] === dist).map(x => x[2]))].sort();
        subs.forEach(s => subSel.add(new Option(s, s)));
        subSel.disabled = false;
    }
}

// 4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏• -> ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå
function chSubP(p) {
    const prov = document.getElementById(p + '_addr_prov').value;
    const dist = document.getElementById(p + '_addr_dist').value;
    const sub = document.getElementById(p + '_addr_sub').value;
    const zipInp = document.getElementById(p + '_addr_zip');

    if (sub) {
        // ‡∏´‡∏≤ row ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á 3 ‡∏≠‡∏¢‡πà‡∏≤‡∏á
        const found = addrDB.find(x => x[0] === prov && x[1] === dist && x[2] === sub);
        if (found) {
            zipInp.value = found[3]; // ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (index 3)
        }
    }
}

    function exportToExcel() {
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ allSt ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (typeof allSt === 'undefined' || allSt.length === 0) {
        Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'warning');
        return;
    }

    let html = `<meta charset="utf-8"><table border="1">
        <tr style="background-color: #198754; color: white;">
            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
            <th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</th>
            <th>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
            <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        </tr>`;

    allSt.forEach((s, idx) => {
        html += `<tr>
            <td align="center">${idx + 1}</td>
            <td style="mso-number-format:'\\@';">'${s.idCard}</td>
            <td>${s.name}</td>
            <td align="center">${s.level}</td>
            <td>${s.plan}</td>
            <td style="mso-number-format:'\\@';">'${s.phone}</td>
            <td>${s.status}</td>
        </tr>`;
    });
    html += `</table>`;

    const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£_' + new Date().toLocaleDateString() + '.xls';
    a.click();
}

// ‡∏™‡∏±‡πà‡∏á‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Loading ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
window.addEventListener('load', function() {
  const loader = document.getElementById('initial-loader');
  
  // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (0.8 ‡∏ß‡∏¥) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏π‡∏ó ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏ß‡∏ö‡∏´‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
  setTimeout(() => {
    if (loader) {
      loader.style.opacity = '0'; // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏à‡∏≤‡∏á‡∏•‡∏á
      
      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏≤‡∏á‡∏à‡∏ô‡∏™‡∏∏‡∏î (0.5 ‡∏ß‡∏¥) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á
      setTimeout(() => {
        loader.style.display = 'none';
      }, 500); 
    }
  }, 800);
});


   function checkSystemStatus() {
  google.script.run.withSuccessHandler(function(status) {
    // ‡∏ñ‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏õ‡∏¥‡∏î -> ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á openForm('special')
    if (!status.special) {
      disableBtn('special', '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£');
    }
    // ‡∏ñ‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏õ‡∏¥‡∏î -> ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á openForm('general')
    if (!status.general) {
      disableBtn('general', '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£');
    }
  }).getRecruitStatus();
  }

  function disableBtn(type, msg) {
  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ onclick="openForm('type')"
  var btn = document.querySelector(`button[onclick="openForm('${type}')"]`);
  if (btn) {
    btn.disabled = true;
    btn.className = "btn btn-secondary w-100 btn-lg-custom shadow-sm"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
    btn.innerHTML = `<i class="bi bi-lock-fill me-2"></i> ${msg}`;
  }
}


  // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå Admin ---

// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå
function toggleSystem(type, el) {
  var isOpen = el.checked;
  var name = (type === 'special') ? '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©' : '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
  
  el.disabled = true; // ‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏£‡∏±‡∏ß

  google.script.run.withSuccessHandler(function() {
    el.disabled = false;
    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á
    const Toast = Swal.mixin({
      toast: true, position: 'top-end', showConfirmButton: false, timer: 3000, timerProgressBar: true
    });
    Toast.fire({
      icon: 'success',
      title: (isOpen ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î') + '‡∏£‡∏∞‡∏ö‡∏ö ' + name + ' ‡πÅ‡∏•‡πâ‡∏ß'
    });
  }).withFailureHandler(function(err){
    el.disabled = false;
    el.checked = !isOpen; // ‡∏î‡∏µ‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏Å‡∏•‡∏±‡∏ö‡∏ñ‡πâ‡∏≤ error
    Swal.fire('Error', err.message, 'error');
  }).setRecruitStatus(type, isOpen);
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Admin
function loadAdminStatus() {
  google.script.run.withSuccessHandler(function(status) {
    var tSpec = document.getElementById('toggleSpecial');
    var tGen = document.getElementById('toggleGeneral');
    
    if(tSpec) tSpec.checked = status.special;
    if(tGen) tGen.checked = status.general;
  }).getRecruitStatus();
}
document.addEventListener('DOMContentLoaded', function() {
    checkSystemStatus();
    initThaiOnlyInput();
  });

  // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ---
function initThaiOnlyInput() {
  // 1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á input ‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™ 'text-only'
  const inputs = document.querySelectorAll('.text-only');

  inputs.forEach(input => {
    input.addEventListener('input', function() {
      const original = this.value;
      
      // 2. ‡πÉ‡∏ä‡πâ Regex ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (\u0E00-\u0E7F) ‡πÅ‡∏•‡∏∞ ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á (\s)
      // ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©, ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç, ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á
      const clean = original.replace(/[^\u0E00-\u0E7F\s]/g, '');

      if (original !== clean) {
        this.value = clean;
        
        // (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°) ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î
        // Swal.mixin({
        //   toast: true, position: 'top-end', showConfirmButton: false, timer: 1500
        // }).fire({ icon: 'warning', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô' });
      }
    });
  });
}

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' --- */
  function toggleOther(selectId, inputId) {
     const selectObj = document.getElementById(selectId);
     const inputObj = document.getElementById(inputId);
     
     if(selectObj.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
        inputObj.classList.remove('hidden'); // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
        inputObj.required = true;           // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å
        inputObj.focus();                   // ‡πÄ‡∏≠‡∏≤‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏£‡∏≠
     } else {
        inputObj.classList.add('hidden');    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
        inputObj.required = false;          // ‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö
        inputObj.value = '';                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
     }
  }

  /* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) --- */
  function getVal(selectId, inputId) {
     const val = document.getElementById(selectId).value;
     if(val === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÅ‡∏ó‡∏ô
        return document.getElementById(inputId).value; 
     }
     return val;
  }

  // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö Timer
let progressInterval;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î: ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≠‡∏î‡∏ß‡∏¥‡πà‡∏á
function startSimulatedProgress() {
    // 1. ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Loading
    document.getElementById('loading').classList.remove('hidden');
    
    const bar = document.getElementById('progressBar');
    let width = 0;
    bar.style.width = '0%';
    bar.innerText = '0%';
    
    // 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏≠‡∏Å‡πÜ
    progressInterval = setInterval(() => {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (1-4%)
        width += Math.random() * 4; 
        
        // ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≠‡∏ó‡∏µ‡πà 90% (‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö)
        if (width > 90) width = 90; 
        
        bar.style.width = Math.round(width) + '%';
        bar.innerText = Math.round(width) + '%';
    }, 500); // ‡∏Ç‡∏¢‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏´‡∏•‡∏î: ‡∏î‡∏µ‡∏î‡πÑ‡∏õ 100% ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Loading
function stopSimulatedProgress() {
    clearInterval(progressInterval); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏ö
    const bar = document.getElementById('progressBar');
    
    // ‡∏î‡∏µ‡∏î‡πÑ‡∏õ 100%
    bar.style.width = '100%';
    bar.innerText = '100%';
    
    // ‡∏£‡∏≠‡πÅ‡∏õ‡πä‡∏ö‡∏ô‡∏∂‡∏á (0.5‡∏ß‡∏¥) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏° 100 ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏¥‡∏î
    setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
    }, 500);
}

function previewDoc(url) {
    if (!url) return;

    let previewUrl = url;
    // ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î Preview ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà iframe
    try {
        let id = "";
        if (url.indexOf('id=') > -1) id = url.split('id=')[1].split('&')[0];
        else if (url.indexOf('/d/') > -1) id = url.split('/d/')[1].split('/')[0];

        if (id) {
            previewUrl = "https://drive.google.com/file/d/" + id + "/preview";
        }
    } catch (e) { console.log(e); }

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ iframe ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á
    document.getElementById('docFrame').src = previewUrl;
    document.getElementById('btnOpenOriginal').href = url;

    // ‡πÄ‡∏õ‡∏¥‡∏î Modal (‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö Modal ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
    new bootstrap.Modal(document.getElementById('docPreviewModal')).show();
}
  
  function printCard(rowIndex) {
    const s = allSt.find(x => x.rowIndex === rowIndex);
    if (!s) { alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"); return; }

    const schoolName = "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏£‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®";
    const year = "2569";
    const examSeatNo = s.fullData[47] || "-"; 
    let photoUrl = getDirectImg(s.photo);
    
    // ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ
    const logoUrl = "https://drive.google.com/thumbnail?id=1orEjf83Ew6ygXmhqSyEmGawrvy0UUhGq&sz=w200";

    let htmlContent = `
    <html><head><title>‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≠‡∏ö - ${s.name}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        @page { size: A4; margin: 0; }
        body { 
            font-family: 'Sarabun', sans-serif; 
            margin: 0; padding: 0; background: #eee; 
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
        }
        
        .card-box { 
            width: 160mm; height: 110mm; 
            border: 5px double #0d6efd; 
            background: #fff;
            padding: 30px 40px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Padding ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏°‡∏î‡∏∏‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô */
            box-sizing: border-box;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex; 
            flex-direction: column; 
            /* justify-content: center; ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
        }

        .header { 
            text-align: center; border-bottom: 2px solid #ccc; 
            padding-bottom: 15px; margin-bottom: 20px; 
            display: flex; align-items: center; justify-content: center; gap: 15px; 
        }
        .logo { width: 70px; height: 70px; object-fit: contain; } 
        .header-text { text-align: left; }
        .header h2 { margin: 0; font-size: 24px; font-weight: bold; color: #0d6efd; line-height: 1.2; }
        .header p { margin: 2px 0 0; font-size: 16px; color: #555; }

        .content { 
            display: flex; align-items: flex-start; 
        }
        .info-col { flex: 1; font-size: 16px; line-height: 1.8; padding-right: 20px; }
        .photo-col { width: 110px; text-align: center; }
        .photo { width: 100px; height: 125px; object-fit: cover; border: 1px solid #999; border-radius: 4px; background: #eee; }
        
        .row-item { display: flex; align-items: baseline; margin-bottom: 8px; white-space: nowrap; }
        .label { font-weight: bold; width: 120px; color: #333; flex-shrink: 0; }
        .seat-highlight { color: #d63384; font-weight: bold; font-size: 18px; background: #fff0f6; padding: 0 8px; border-radius: 4px; border: 1px dashed #d63384; }

        .fab-print {
            position: fixed; bottom: 20px; right: 20px;
            background: #0d6efd; color: white; border: none;
            width: 60px; height: 60px; border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 999;
        }

        @media print { 
            body { background: white; display: block; }
            .card-box { 
                box-shadow: none; border: 3px solid #000;
                position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                width: 160mm; height: 110mm;
            }
            .no-print { display: none !important; }
        }
    </style>
    </head><body>
        <div class="card-box">
            <div class="header">
                <img src="${logoUrl}" class="logo">
                <div class="header-text">
                    <h2>‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h2>
                    <p>${schoolName} | ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${year}</p>
                </div>
            </div>
            
            <div class="content">
                <div class="info-col">
                    <div class="row-item"><span class="label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö:</span> <span class="seat-highlight">${examSeatNo}</span></div>
                    <div class="row-item"><span class="label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</span> <span>${s.name}</span></div>
                    <div class="row-item"><span class="label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏ä‡∏ä.:</span> <span>${s.idCard}</span></div>
                    <div class="row-item"><span class="label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</span> <span>${s.level}</span></div>
                    <div class="row-item"><span class="label">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span> <span style="font-size:15px;">${s.plan}</span></div>
                    <div class="row-item"><span class="label">‡∏™‡∏ô‡∏≤‡∏°‡∏™‡∏≠‡∏ö:</span> <span>${schoolName}</span></div>
                </div>
                <div class="photo-col">
                    <img src="${photoUrl}" class="photo" onerror="this.src='https://via.placeholder.com/150?text=No+Photo'">
                    <div style="font-size:11px; margin-top:5px; color:#666;">(‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢)</div>
                </div>
            </div>
        </div>
        
        <button class="fab-print no-print" onclick="window.print()">üñ®Ô∏è</button>

    </body></html>
    `;

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Mobile/PC
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    if (isMobile) {
        let win = window.open('', '_blank');
        if (win) {
            win.document.write(htmlContent);
            win.document.close();
            setTimeout(() => { win.print(); }, 1500);
        } else {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î Pop-up ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£");
        }
    } else {
        let iframe = document.getElementById('printFrame');
        if (!iframe) {
            iframe = document.createElement('iframe');
            iframe.id = 'printFrame';
            iframe.style.position = 'fixed'; 
            iframe.style.right = '0'; iframe.style.bottom = '0';
            iframe.style.width = '0'; iframe.style.height = '0'; iframe.style.border = '0';
            document.body.appendChild(iframe);
        }
        let doc = iframe.contentWindow.document;
        doc.open(); doc.write(htmlContent); doc.close();
        iframe.contentWindow.focus();
        setTimeout(function() { iframe.contentWindow.print(); }, 1000);
    }
}
// ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏à‡∏≠ (User)
let foundStudentData = null;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User (‡πÉ‡∏ä‡πâ Template ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö V.10)
function printCardUser(dataObj) {
    if (!dataObj) { alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"); return; }
    
    // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Object ‡∏ó‡∏µ‡πà Server ‡∏™‡πà‡∏á‡∏°‡∏≤ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà Template ‡∏ö‡∏±‡∏ï‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    // fullData index: 0=Time, 1=AppID, ..., 5=Level, 6=Plan, ..., 13=IDCard, ..., 23=Photo
    const s = {
        name: dataObj.name,
        seatNo: dataObj.seatNo || "-",
        idCard: (dataObj.fullData && dataObj.fullData[17]) ? dataObj.fullData[17] : "-",
        level: (dataObj.fullData && dataObj.fullData[5]) ? dataObj.fullData[5] : "-",
        plan: (dataObj.fullData && dataObj.fullData[6]) ? dataObj.fullData[6] : "-",
        photo: (dataObj.fullData && dataObj.fullData[43]) ? dataObj.fullData[43] : ""
    };

    const schoolName = "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏£‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®";
    const year = "2569";
    let photoUrl = getDirectImg(s.photo); 
    const logoUrl = "https://drive.google.com/thumbnail?id=1orEjf83Ew6ygXmhqSyEmGawrvy0UUhGq&sz=w200";

    // HTML ‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≠‡∏ö (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô V.10 ‡πÄ‡∏õ‡πä‡∏∞)
    let htmlContent = `
    <html><head><title>‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏≠‡∏ö - ${s.name}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        @page { size: A4; margin: 0; }
        body { font-family: 'Sarabun', sans-serif; margin: 0; padding: 0; background: #eee; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .card-box { width: 160mm; height: 110mm; border: 5px double #0d6efd; background: #fff; padding: 30px 40px; box-sizing: border-box; display: flex; flex-direction: column; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 2px solid #ccc; padding-bottom: 15px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .logo { width: 70px; height: 70px; object-fit: contain; } 
        .header h2 { margin: 0; font-size: 24px; font-weight: bold; color: #0d6efd; line-height: 1.2; }
        .header p { margin: 2px 0 0; font-size: 16px; color: #555; }
        .content { display: flex; align-items: flex-start; }
        .info-col { flex: 1; font-size: 16px; line-height: 1.8; padding-right: 20px; }
        .photo-col { width: 110px; text-align: center; }
        .photo { width: 100px; height: 125px; object-fit: cover; border: 1px solid #999; border-radius: 4px; background: #eee; }
        .row-item { display: flex; align-items: baseline; margin-bottom: 8px; white-space: nowrap; }
        .label { font-weight: bold; width: 120px; color: #333; flex-shrink: 0; }
        .seat-highlight { color: #d63384; font-weight: bold; font-size: 18px; background: #fff0f6; padding: 0 8px; border-radius: 4px; border: 1px dashed #d63384; }
        .fab-print { position: fixed; bottom: 20px; right: 20px; background: #0d6efd; color: white; border: none; width: 60px; height: 60px; border-radius: 50%; font-size: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 999; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        @media print { body { background: white; display: block; } .card-box { box-shadow: none; border: 3px solid #000; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 160mm; height: 110mm; } .no-print { display: none !important; } }
    </style>
    </head><body>
        <div class="card-box">
            <div class="header">
                <img src="${logoUrl}" class="logo">
                <div><h2>‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö</h2><p>${schoolName} | ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ${year}</p></div>
            </div>
            <div class="content">
                <div class="info-col">
                    <div class="row-item"><span class="label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏™‡∏≠‡∏ö:</span> <span class="seat-highlight">${s.seatNo}</span></div>
                    <div class="row-item"><span class="label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</span> <span>${s.name}</span></div>
                    <div class="row-item"><span class="label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏ä‡∏ä.:</span> <span>${s.idCard}</span></div>
                    <div class="row-item"><span class="label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</span> <span>${s.level}</span></div>
                    <div class="row-item"><span class="label">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span> <span style="font-size:15px;">${s.plan}</span></div>
                    <div class="row-item"><span class="label">‡∏™‡∏ô‡∏≤‡∏°‡∏™‡∏≠‡∏ö:</span> <span>${schoolName}</span></div>
                </div>
                <div class="photo-col">
                    <img src="${photoUrl}" class="photo" onerror="this.src='https://via.placeholder.com/150?text=No+Photo'">
                    <div style="font-size:11px; margin-top:5px; color:#666;">(‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢)</div>
                </div>
            </div>
        </div>
        <button class="fab-print no-print" onclick="window.print()">üñ®Ô∏è</button>
    </body></html>`;

    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    if (isMobile) {
        let win = window.open('', '_blank');
        if (win) { win.document.write(htmlContent); win.document.close(); setTimeout(() => win.print(), 1500); }
        else { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î Pop-up"); }
    } else {
        let iframe = document.getElementById('printFrame');
        if (!iframe) {
            iframe = document.createElement('iframe');
            iframe.id = 'printFrame'; iframe.style.cssText = 'position:fixed;right:0;bottom:0;width:0;height:0;border:0;';
            document.body.appendChild(iframe);
        }
        let doc = iframe.contentWindow.document;
        doc.open(); doc.write(htmlContent); doc.close();
        iframe.contentWindow.focus();
        setTimeout(() => iframe.contentWindow.print(), 1000);
    }
}

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á text-eng ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
document.querySelectorAll('.text-eng').forEach(function(el) {
    el.addEventListener('input', function() {
        // ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå: A-Z, a-z, ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á, ‡∏à‡∏∏‡∏î(.), ‡∏Ç‡∏µ‡∏î(-)
        // ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏≠‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢, ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)
        this.value = this.value.replace(/[^a-zA-Z\s.-]/g, '');
    });
});

  </script>
  <div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold"><i class="bi bi-person-vcard-fill"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-5 text-center mb-3">
                        <div class="border rounded p-2 bg-light d-flex align-items-center justify-content-center" style="min-height: 220px;">
                            <img id="vPhoto" src="" class="img-fluid rounded shadow-sm" style="max-height: 250px;" alt="‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢">
                        </div>
                        <div class="d-grid gap-2 mt-2">
                             <a id="vTranscript" href="#" target="_blank" class="btn btn-primary">
                                <i class="bi bi-file-earmark-pdf"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÉ‡∏ö ‡∏õ‡∏û.1
                             </a>
                             <a id="vConduct" href="#" target="_blank" class="btn btn-info text-white">
                                <i class="bi bi-file-person"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥
                             </a>
                        </div>
                    </div>
                    <div class="col-md-7">
                        <h4 id="vName" class="text-primary fw-bold mb-3"></h4>
                        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</strong> <span id="vIdCard">-</span></p>
                        <p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</strong> <span id="vLevel">-</span></p>
                        <p><strong>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> <span id="vPlan" class="text-success fw-bold">-</span></p>
                        <hr>
                        <div class="mb-3">
                            <label class="fw-bold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
                            <span id="vStatus" class="badge bg-secondary fs-6">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
